<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Sistema de Gest√£o Empresarial</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6600;
            --secondary: #1a1a1a;
            --tertiary: #2d2d2d;
            --text: #FFFFFF;
            --text-gray: #AFAFAF;
            --success: #10b981;
            --warning: #fbbf24;
            --danger: #ef4444;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #000000;
            color: var(--text);
            min-height: 100vh;
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .login-title {
            text-align: center;
            color: var(--primary);
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-gray);
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: var(--text-gray);
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            background: var(--tertiary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn {
            width: 100%;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: rgba(255, 102, 0, 0.8);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Dashboard */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .dashboard-container.active {
            display: block;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: var(--secondary);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .menu-toggle {
            display: none;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            margin-right: 16px;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }

        .logo-image {
            max-width: 100%;
            max-height: 120px;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }

        .logo-text {
            color: var(--primary);
            font-size: 24px;
            font-weight: 700;
        }

        .sidebar-logo:has(.logo-image) .logo-text {
            font-size: 20px;
        }

        /* Quando s√≥ tem logo (sem texto), centralizar */
        .sidebar-logo:has(.logo-image:not([style*="display: none"])):has(.logo-text[style*="display: none"]) {
            justify-content: center;
        }

        .login-logo-container {
            text-align: center;
            margin-bottom: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .login-logo {
            max-width: 280px;
            max-height: 160px;
            width: auto;
            height: auto;
            object-fit: contain;
            margin-bottom: 16px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-gray);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .menu-item.active {
            background: rgba(255, 102, 0, 0.2);
            color: var(--primary);
            border: 1px solid rgba(255, 102, 0, 0.3);
        }

        .main-content {
            margin-left: 260px;
            padding: 24px;
        }

        .header {
            background: var(--secondary);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 24px;
            margin: -24px -24px 24px -24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .user-email {
            font-size: 12px;
            color: var(--text-gray);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .btn-logout {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Cards */
        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-gray);
            margin-bottom: 24px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: rgba(255, 102, 0, 0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            color: var(--text-gray);
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 102, 0, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 24px;
        }

        .card-footer {
            font-size: 12px;
            color: var(--text-gray);
        }

        .section-card {
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-gray);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            color: var(--text-gray);
            font-weight: 600;
            font-size: 14px;
        }

        td {
            color: var(--text);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-ativo {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-inativo {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .badge-planejamento {
            background: rgba(147, 197, 253, 0.2);
            color: #60a5fa;
        }

        .badge-em-andamento {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-pausado {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge-concluido {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-cancelado {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Badges de Status de Or√ßamento */
        .badge-rascunho {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }

        .badge-enviado {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .badge-aprovado {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-rejeitado {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .badge-expirado {
            background: rgba(107, 114, 128, 0.2);
            color: #6b7280;
        }

        /* Badges de Prioridade */
        .badge-prioridade-baixa {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }

        .badge-prioridade-media {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .badge-prioridade-alta {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge-prioridade-urgente {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Tags */
        .tag-badge {
            background: rgba(255, 102, 0, 0.2);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn-action {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 8px;
            transition: all 0.3s;
        }

        .btn-action:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-action.edit {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-action.delete {
            border-color: var(--danger);
            color: var(--danger);
        }

        .search-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            background: var(--tertiary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text);
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .btn-close {
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-close:hover {
            color: var(--text);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
            }

            .menu-toggle {
                display: block;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 95vh;
            }

            .header {
                padding: 12px 16px;
            }

            .header-title {
                font-size: 18px;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 600px;
            }

            /* Tabela de itens do or√ßamento - vers√£o mobile */
            #orcamentoItensTable {
                display: block;
                width: 100%;
            }

            #orcamentoItensTable thead {
                display: none;
            }

            #orcamentoItensTable tbody,
            #orcamentoItensTable tr,
            #orcamentoItensTable td {
                display: block;
                width: 100%;
            }

            #orcamentoItensTable tr {
                margin-bottom: 16px;
                background: var(--tertiary);
                border-radius: 8px;
                padding: 12px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            #orcamentoItensTable td {
                padding: 8px 0;
                text-align: left !important;
                border: none;
            }

            #orcamentoItensTable td:before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--primary);
                display: block;
                margin-bottom: 4px;
                font-size: 12px;
            }

            #orcamentoItensTable tfoot tr {
                background: transparent;
                border: none;
                padding: 0;
            }

            #orcamentoItensTable tfoot td {
                padding: 8px 0;
            }

            .modal-actions {
                flex-direction: column;
            }

            .modal-actions .btn {
                width: 100%;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .servico-item {
            margin-bottom: 12px;
        }

        .servico-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .servico-submenu {
            margin-left: 26px;
            margin-top: 8px;
            padding-left: 16px;
            border-left: 2px solid rgba(255, 102, 0, 0.3);
            display: none;
        }

        .servico-submenu.active {
            display: block;
        }

        .servico-submenu .checkbox-item {
            margin-bottom: 8px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn-secondary {
            background: var(--tertiary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Detalhes Cliente */
        .details-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .details-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .details-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
        }

        .details-item {
            margin-bottom: 12px;
        }

        .details-label {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .details-value {
            font-size: 14px;
            color: var(--text);
            word-break: break-word;
        }

        .details-value.empty {
            color: var(--text-gray);
            font-style: italic;
        }

        .servicos-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .servico-badge {
            background: rgba(255, 102, 0, 0.2);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: 1px solid var(--danger);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.8);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 102, 0, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
            }

            .header {
                padding: 12px 16px;
                margin: -16px -16px 16px -16px;
            }

            .header-title {
                font-size: 18px;
            }

            .user-info {
                display: none;
            }

            .user-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .btn-logout {
                padding: 6px 12px;
                font-size: 12px;
            }

            .page-title {
                font-size: 24px;
            }

            .page-subtitle {
                font-size: 14px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .card {
                padding: 16px;
            }

            .card-value {
                font-size: 20px;
            }

            .section-card {
                padding: 16px;
            }

            .section-title {
                font-size: 18px;
            }

            .search-bar {
                flex-direction: column;
                gap: 12px;
            }

            .search-input {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 600px;
                font-size: 14px;
            }

            th, td {
                padding: 8px;
                font-size: 12px;
            }

            .btn-action {
                padding: 4px 8px;
                font-size: 11px;
                margin-right: 4px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 95vh;
                margin: 10px;
            }

            .modal-title {
                font-size: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }

            .details-section {
                margin-bottom: 20px;
                padding-bottom: 20px;
            }

            .details-section-title {
                font-size: 16px;
            }

            .modal-actions {
                flex-direction: column-reverse;
                gap: 8px;
            }

            .modal-actions .btn {
                width: 100%;
            }

            .servicos-list {
                gap: 6px;
            }

            .servico-badge, .tag-badge {
                font-size: 11px;
                padding: 3px 10px;
            }

            .login-box {
                padding: 24px;
            }

            .login-title {
                font-size: 28px;
            }

            .login-logo {
                max-width: 100px;
                max-height: 100px;
            }

            .logo-image {
                max-width: 32px;
                max-height: 32px;
            }

            .sidebar-logo:has(.logo-image) .logo-text {
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 12px;
            }

            .header {
                padding: 10px 12px;
                margin: -12px -12px 12px -12px;
            }

            .page-title {
                font-size: 20px;
            }

            .card {
                padding: 12px;
            }

            .card-value {
                font-size: 18px;
            }

            .section-card {
                padding: 12px;
            }

            .modal-content {
                padding: 16px;
            }

            .form-input, .btn {
                font-size: 14px;
            }

            .login-box {
                padding: 20px;
            }

            .login-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo-container">
                <img id="loginLogo" class="login-logo" src="" alt="Logo" style="display: none;">
            </div>
            <h1 class="login-title" id="loginTitle">Sistema de Gest√£o</h1>
            <p class="login-subtitle">Fa√ßa login para continuar</p>
            
            <div id="errorMessage" class="error-message"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="nome">Nome</label>
                    <input 
                        type="text" 
                        id="nome" 
                        class="form-input" 
                        placeholder=""
                        autocomplete="off"
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Senha</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder=""
                        autocomplete="off"
                    >
                </div>
                
                <button type="submit" class="btn btn-primary" id="loginBtn">
                    <span>Entrar</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="dashboard-container">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <img id="sidebarLogo" class="logo-image" src="" alt="Logo" style="display: none;">
                <span class="logo-text" id="sidebarLogoText">Gest√£o</span>
            </div>
            <a href="#" class="menu-item active" data-page="dashboard" onclick="closeSidebarMobile()">
                <span>üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="menu-item" data-page="clientes" onclick="closeSidebarMobile()">
                <span>üë•</span>
                <span>Clientes</span>
            </a>
            <a href="#" class="menu-item" data-page="orcamentos" onclick="closeSidebarMobile()">
                <span>üìÑ</span>
                <span>Or√ßamentos</span>
            </a>
            <a href="#" class="menu-item" data-page="projetos" onclick="closeSidebarMobile()">
                <span>üìÅ</span>
                <span>Projetos</span>
            </a>
            <a href="#" class="menu-item" data-page="financeiro" onclick="closeSidebarMobile()">
                <span>üí∞</span>
                <span>Financeiro</span>
            </a>
            <a href="#" class="menu-item" data-page="plataformas" onclick="closeSidebarMobile()">
                <span>üîë</span>
                <span>Plataformas</span>
            </a>
        </div>

        <div class="main-content">
            <div class="header">
                <div style="display: flex; align-items: center;">
                    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                    <h2 class="header-title">Dashboard</h2>
                </div>
                <div class="header-user">
                    <div class="user-info">
                        <div class="user-name" id="userName">Usu√°rio</div>
                        <div class="user-email" id="userEmail">email@exemplo.com</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">U</div>
                    <button class="btn btn-logout" onclick="logout()">Sair</button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="page-content">
                <h1 class="page-title">Dashboard</h1>
                <p class="page-subtitle">Vis√£o geral do seu neg√≥cio</p>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Faturamento do M√™s</div>
                                <div class="card-value" id="faturamentoMes">R$ 0,00</div>
                            </div>
                            <div class="card-icon">üí∞</div>
                        </div>
                        <div class="card-footer">vs m√™s anterior</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Projetos Ativos</div>
                                <div class="card-value" id="projetosAtivos">0</div>
                            </div>
                            <div class="card-icon">üìÅ</div>
                        </div>
                        <div class="card-footer">Em andamento</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Pagamentos Pendentes</div>
                                <div class="card-value" id="pagamentosPendentes">R$ 0,00</div>
                            </div>
                            <div class="card-icon">‚è∞</div>
                        </div>
                        <div class="card-footer">A receber</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Pagamentos Vencidos</div>
                                <div class="card-value" id="pagamentosVencidos" style="color: var(--danger);">R$ 0,00</div>
                            </div>
                            <div class="card-icon">‚ö†Ô∏è</div>
                        </div>
                        <div class="card-footer">Atrasados</div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Pr√≥ximos Vencimentos (7 dias)</h2>
                    <div class="empty-state">Nenhum vencimento pr√≥ximo</div>
                </div>

                <div class="section-card">
                    <h2 class="section-title">Or√ßamentos Aguardando</h2>
                    <div class="empty-state">Nenhum or√ßamento aguardando aprova√ß√£o</div>
                </div>
            </div>

            <!-- Other Pages Content (hidden by default) -->
            <div id="clientesContent" class="page-content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <div>
                        <h1 class="page-title">Clientes</h1>
                        <p class="page-subtitle">Gerencie seus clientes</p>
                    </div>
                    <button class="btn btn-primary" onclick="openClienteModal()">+ Novo Cliente</button>
                </div>

                <div class="section-card">
                    <div class="search-bar">
                        <input 
                            type="text" 
                            id="clienteSearch" 
                            class="search-input" 
                            placeholder="Buscar por nome, empresa ou email..."
                            onkeyup="filterClientes()"
                        >
                        <select id="clienteStatusFilter" class="form-input" style="width: 200px;" onchange="filterClientes()">
                            <option value="">Todos os status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <div id="clientesLoading" class="loading active">
                            <div class="spinner"></div>
                            <p>Carregando clientes...</p>
                        </div>
                        <table id="clientesTable" style="display: none;">
                            <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Empresa</th>
                            <th>Email</th>
                            <th>Telefone</th>
                            <th>Cidade/Estado</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                            </thead>
                            <tbody id="clientesTableBody">
                            </tbody>
                        </table>
                        <div id="clientesEmpty" class="empty-state" style="display: none;">
                            Nenhum cliente encontrado
                        </div>
                    </div>
                </div>
            </div>

            <div id="projetosContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 24px;">
                    <h1 class="page-title">Projetos</h1>
                    <p class="page-subtitle">Gerencie seus projetos</p>
                </div>

                <div class="section-card">
                    <div class="search-bar">
                        <input 
                            type="text" 
                            id="projetoSearch" 
                            class="search-input" 
                            placeholder="Buscar por nome do projeto ou cliente..."
                            onkeyup="filterProjetos()"
                        >
                        <select id="projetoStatusFilter" class="form-input" style="width: 200px;" onchange="filterProjetos()">
                            <option value="">Todos os status</option>
                            <option value="planejamento">Planejamento</option>
                            <option value="em_andamento">Em Andamento</option>
                            <option value="pausado">Pausado</option>
                            <option value="concluido">Conclu√≠do</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <div id="projetosLoading" class="loading active">
                            <div class="spinner"></div>
                            <p>Carregando projetos...</p>
                        </div>
                        <table id="projetosTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Nome do Projeto</th>
                                    <th>Cliente</th>
                                    <th>Data In√≠cio</th>
                                    <th>Data Prevista</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="projetosTableBody">
                            </tbody>
                        </table>
                        <div id="projetosEmpty" class="empty-state" style="display: none;">
                            Nenhum projeto encontrado
                        </div>
                    </div>
                </div>
            </div>

            <div id="orcamentosContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 24px;">
                    <h1 class="page-title">Or√ßamentos</h1>
                    <p class="page-subtitle">Gerencie seus or√ßamentos</p>
                </div>

                <div class="section-card">
                    <div class="search-bar">
                        <input 
                            type="text" 
                            id="orcamentoSearch" 
                            class="search-input" 
                            placeholder="Buscar por n√∫mero, cliente ou descri√ß√£o..."
                            onkeyup="filterOrcamentos()"
                        >
                        <select id="orcamentoStatusFilter" class="form-input" style="width: 200px;" onchange="filterOrcamentos()">
                            <option value="">Todos os status</option>
                            <option value="rascunho">Rascunho</option>
                            <option value="enviado">Enviado</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="rejeitado">Rejeitado</option>
                            <option value="expirado">Expirado</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <div id="orcamentosLoading" class="loading active">
                            <div class="spinner"></div>
                            <p>Carregando or√ßamentos...</p>
                        </div>
                        <table id="orcamentosTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>N√∫mero</th>
                                    <th>Cliente</th>
                                    <th>Data</th>
                                    <th>Valor</th>
                                    <th>Validade</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="orcamentosTableBody">
                            </tbody>
                        </table>
                        <div id="orcamentosEmpty" class="empty-state" style="display: none;">
                            Nenhum or√ßamento encontrado
                        </div>
                    </div>
                </div>
            </div>

            <div id="financeiroContent" class="page-content" style="display: none;">
                <h1 class="page-title">Financeiro</h1>
                <p class="page-subtitle">Controle financeiro</p>
                <div class="section-card">
                    <div class="empty-state">Funcionalidade em desenvolvimento</div>
                </div>
            </div>

            <div id="plataformasContent" class="page-content" style="display: none;">
                <h1 class="page-title">Plataformas</h1>
                <p class="page-subtitle">Controle de plataformas e senhas</p>
                <div class="section-card">
                    <div class="empty-state">Funcionalidade em desenvolvimento</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div id="clienteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="clienteModalTitle">Novo Cliente</h2>
                <button class="btn-close" onclick="closeClienteModal()">&times;</button>
            </div>
            <form id="clienteForm">
                <input type="hidden" id="clienteId">
                
                <div class="form-group">
                    <label class="form-label">Nome *</label>
                    <input type="text" id="clienteNome" class="form-input" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Empresa</label>
                        <input type="text" id="clienteEmpresa" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" id="clienteEmail" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="text" id="clienteTelefone" class="form-input" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">WhatsApp</label>
                        <input type="text" id="clienteWhatsapp" class="form-input" placeholder="(00) 00000-0000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF/CNPJ</label>
                        <input type="text" id="clienteCpfCnpj" class="form-input" placeholder="000.000.000-00 ou 00.000.000/0000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Segmento</label>
                        <input type="text" id="clienteSegmento" class="form-input" placeholder="Ex: Distribuidor, Varejo, Servi√ßos">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Endere√ßo Completo</label>
                    <input type="text" id="clienteEndereco" class="form-input" placeholder="Rua, n√∫mero, complemento">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Cidade</label>
                        <input type="text" id="clienteCidade" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado</label>
                        <select id="clienteEstado" class="form-input">
                            <option value="">Selecione</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Esp√≠rito Santo</option>
                            <option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Par√°</option>
                            <option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CEP</label>
                        <input type="text" id="clienteCep" class="form-input" placeholder="00000-000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Cadastro</label>
                        <input type="date" id="clienteDataCadastro" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Origem do Cliente</label>
                        <select id="clienteOrigem" class="form-input">
                            <option value="">Selecione</option>
                            <option value="indicacao">Indica√ß√£o</option>
                            <option value="google">Google</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="site">Site pr√≥prio</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="clienteStatus" class="form-input">
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea id="clienteObservacoes" class="form-input" rows="4" style="resize: vertical;"></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeClienteModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalhes Cliente -->
    <div id="clienteDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Detalhes do Cliente</h2>
                <button class="btn-close" onclick="closeClienteDetailsModal()">&times;</button>
            </div>
            <div id="clienteDetailsContent" style="color: var(--text);">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeClienteDetailsModal()">Fechar</button>
                <button type="button" class="btn btn-primary" id="editFromDetailsBtn" onclick="">Editar</button>
                <button type="button" class="btn btn-danger" id="deleteFromDetailsBtn" onclick="">Excluir</button>
            </div>
        </div>
    </div>

    <!-- Modal Projeto -->
    <div id="projetoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="projetoModalTitle">Novo Projeto</h2>
                <button class="btn-close" onclick="closeProjetoModal()">&times;</button>
            </div>
            <form id="projetoForm">
                <input type="hidden" id="projetoId">
                
                <div class="form-group">
                    <label class="form-label">Nome do Projeto *</label>
                    <input type="text" id="projetoNome" class="form-input" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Cliente *</label>
                        <select id="projetoClienteId" class="form-input" required>
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select id="projetoStatus" class="form-input" required>
                            <option value="planejamento">Planejamento</option>
                            <option value="em_andamento">Em Andamento</option>
                            <option value="pausado">Pausado</option>
                            <option value="concluido">Conclu√≠do</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Prioridade</label>
                        <select id="projetoPrioridade" class="form-input">
                            <option value="">Selecione a prioridade</option>
                            <option value="baixa">Baixa</option>
                            <option value="media">M√©dia</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respons√°vel</label>
                        <select id="projetoResponsavelId" class="form-input">
                            <option value="">Selecione um respons√°vel</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de In√≠cio</label>
                        <input type="date" id="projetoDataInicio" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data Prevista de Conclus√£o</label>
                        <input type="date" id="projetoDataPrevista" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Conclus√£o</label>
                        <input type="date" id="projetoDataConclusao" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor do Projeto (R$)</label>
                        <input type="number" id="projetoValor" class="form-input" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Tags/Categorias</label>
                    <input type="text" id="projetoTags" class="form-input" placeholder="Ex: urgente, site, e-commerce (separadas por v√≠rgula)">
                    <small style="color: var(--text-gray); font-size: 12px; margin-top: 4px; display: block;">Separe as tags por v√≠rgula</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="projetoDescricao" class="form-input" rows="4" style="resize: vertical;" placeholder="Descreva o projeto..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea id="projetoObservacoes" class="form-input" rows="3" style="resize: vertical;" placeholder="Observa√ß√µes adicionais..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeProjetoModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalhes Projeto -->
    <div id="projetoDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Detalhes do Projeto</h2>
                <button class="btn-close" onclick="closeProjetoDetailsModal()">&times;</button>
            </div>
            <div id="projetoDetailsContent" style="color: var(--text);">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeProjetoDetailsModal()">Fechar</button>
                <button type="button" class="btn btn-primary" id="editProjetoFromDetailsBtn" onclick="">Editar</button>
                <button type="button" class="btn btn-danger" id="deleteProjetoFromDetailsBtn" onclick="">Excluir</button>
            </div>
        </div>
    </div>

    <!-- Modal Or√ßamento -->
    <div id="orcamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="orcamentoModalTitle">Novo Or√ßamento</h2>
                <button class="btn-close" onclick="closeOrcamentoModal()">&times;</button>
            </div>
            <form id="orcamentoForm">
                <input type="hidden" id="orcamentoId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">N√∫mero do Or√ßamento</label>
                        <input type="text" id="orcamentoNumero" class="form-input" placeholder="Gerado automaticamente" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cliente *</label>
                        <select id="orcamentoClienteId" class="form-input" required>
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data do Or√ßamento *</label>
                        <input type="date" id="orcamentoData" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Validade (dias) *</label>
                        <input type="number" id="orcamentoValidade" class="form-input" min="1" value="30" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" style="margin-bottom: 12px; display: block;">Servi√ßos a serem Oferecidos</label>
                    <div class="checkbox-group" id="orcamentoServicosContainer" style="background: var(--tertiary); padding: 16px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); max-height: 400px; overflow-y: auto;">
                        <!-- Automa√ß√£o -->
                        <div class="servico-item">
                            <div class="servico-main">
                                <input type="checkbox" id="orcamentoServicoAutomacao" value="automacao" onchange="toggleSubmenu('orcamento', 'automacao')">
                                <label for="orcamentoServicoAutomacao" style="font-weight: 600;">Automa√ß√£o</label>
                            </div>
                            <div class="servico-submenu" id="orcamentoSubmenuAutomacao">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoAutomacaoWhatsapp" value="automacao_whatsapp" onchange="adicionarServicoAoOrcamento('automacao_whatsapp', 'Automa√ß√£o - WhatsApp')">
                                    <label for="orcamentoAutomacaoWhatsapp">WhatsApp</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoAutomacaoFacebook" value="automacao_facebook" onchange="adicionarServicoAoOrcamento('automacao_facebook', 'Automa√ß√£o - Facebook')">
                                    <label for="orcamentoAutomacaoFacebook">Facebook</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoAutomacaoInstagram" value="automacao_instagram" onchange="adicionarServicoAoOrcamento('automacao_instagram', 'Automa√ß√£o - Instagram')">
                                    <label for="orcamentoAutomacaoInstagram">Instagram</label>
                                </div>
                            </div>
                        </div>

                        <!-- Site -->
                        <div class="servico-item">
                            <div class="servico-main">
                                <input type="checkbox" id="orcamentoServicoSite" value="site" onchange="toggleSubmenu('orcamento', 'site')">
                                <label for="orcamentoServicoSite" style="font-weight: 600;">Site</label>
                            </div>
                            <div class="servico-submenu" id="orcamentoSubmenuSite">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoSiteCriacao" value="site_criacao" onchange="adicionarServicoAoOrcamento('site_criacao', 'Site - Cria√ß√£o')">
                                    <label for="orcamentoSiteCriacao">Cria√ß√£o</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoSitePersonalizacao" value="site_personalizacao" onchange="adicionarServicoAoOrcamento('site_personalizacao', 'Site - Personaliza√ß√£o')">
                                    <label for="orcamentoSitePersonalizacao">Personaliza√ß√£o</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoSitePaginaCaptura" value="site_pagina_captura" onchange="adicionarServicoAoOrcamento('site_pagina_captura', 'Site - P√°gina de Captura')">
                                    <label for="orcamentoSitePaginaCaptura">P√°gina de Captura</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoSiteEcommerce" value="site_ecommerce" onchange="adicionarServicoAoOrcamento('site_ecommerce', 'Site - E-commerce')">
                                    <label for="orcamentoSiteEcommerce">E-commerce</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoSiteLandingPage" value="site_landing_page" onchange="adicionarServicoAoOrcamento('site_landing_page', 'Site - Landing Page')">
                                    <label for="orcamentoSiteLandingPage">Landing Page</label>
                                </div>
                            </div>
                        </div>

                        <!-- Tr√°fego -->
                        <div class="servico-item">
                            <div class="servico-main">
                                <input type="checkbox" id="orcamentoServicoTrafego" value="trafego" onchange="toggleSubmenu('orcamento', 'trafego')">
                                <label for="orcamentoServicoTrafego" style="font-weight: 600;">Tr√°fego</label>
                            </div>
                            <div class="servico-submenu" id="orcamentoSubmenuTrafego">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoMetaAds" value="trafego_meta_ads" onchange="adicionarServicoAoOrcamento('trafego_meta_ads', 'Tr√°fego - Configura√ß√£o Meta Ads')">
                                    <label for="orcamentoTrafegoMetaAds">Configura√ß√£o Meta Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoGoogleAds" value="trafego_google_ads" onchange="adicionarServicoAoOrcamento('trafego_google_ads', 'Tr√°fego - Configura√ß√£o Google Ads')">
                                    <label for="orcamentoTrafegoGoogleAds">Configura√ß√£o Google Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoBM" value="trafego_bm" onchange="adicionarServicoAoOrcamento('trafego_bm', 'Tr√°fego - Configura√ß√£o BM')">
                                    <label for="orcamentoTrafegoBM">Configura√ß√£o BM (Business Manager)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoCriacaoCampanha" value="trafego_criacao_campanha" onchange="adicionarServicoAoOrcamento('trafego_criacao_campanha', 'Tr√°fego - Cria√ß√£o de Campanha')">
                                    <label for="orcamentoTrafegoCriacaoCampanha">Cria√ß√£o de Campanha</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoOtimizacao" value="trafego_otimizacao" onchange="adicionarServicoAoOrcamento('trafego_otimizacao', 'Tr√°fego - Otimiza√ß√£o de Campanhas')">
                                    <label for="orcamentoTrafegoOtimizacao">Otimiza√ß√£o de Campanhas</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoTrafegoRemarketing" value="trafego_remarketing" onchange="adicionarServicoAoOrcamento('trafego_remarketing', 'Tr√°fego - Remarketing')">
                                    <label for="orcamentoTrafegoRemarketing">Remarketing</label>
                                </div>
                            </div>
                        </div>

                        <!-- Design -->
                        <div class="servico-item">
                            <div class="servico-main">
                                <input type="checkbox" id="orcamentoServicoDesign" value="design" onchange="toggleSubmenu('orcamento', 'design')">
                                <label for="orcamentoServicoDesign" style="font-weight: 600;">Design</label>
                            </div>
                            <div class="servico-submenu" id="orcamentoSubmenuDesign">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignCriacaoPost" value="design_criacao_post" onchange="adicionarServicoAoOrcamento('design_criacao_post', 'Design - Cria√ß√£o de Post')">
                                    <label for="orcamentoDesignCriacaoPost">Cria√ß√£o de Post</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignCriacaoStories" value="design_criacao_stories" onchange="adicionarServicoAoOrcamento('design_criacao_stories', 'Design - Cria√ß√£o de Stories')">
                                    <label for="orcamentoDesignCriacaoStories">Cria√ß√£o de Stories</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignCriacaoFotosIA" value="design_criacao_fotos_ia" onchange="adicionarServicoAoOrcamento('design_criacao_fotos_ia', 'Design - Cria√ß√£o de Fotos com IA')">
                                    <label for="orcamentoDesignCriacaoFotosIA">Cria√ß√£o de Fotos com IA</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignIdentidadeVisual" value="design_identidade_visual" onchange="adicionarServicoAoOrcamento('design_identidade_visual', 'Design - Identidade Visual')">
                                    <label for="orcamentoDesignIdentidadeVisual">Identidade Visual</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignLogo" value="design_logo" onchange="adicionarServicoAoOrcamento('design_logo', 'Design - Cria√ß√£o de Logo')">
                                    <label for="orcamentoDesignLogo">Cria√ß√£o de Logo</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoDesignBanner" value="design_banner" onchange="adicionarServicoAoOrcamento('design_banner', 'Design - Banners e Materiais')">
                                    <label for="orcamentoDesignBanner">Banners e Materiais</label>
                                </div>
                            </div>
                        </div>

                        <!-- Redes Sociais -->
                        <div class="servico-item">
                            <div class="servico-main">
                                <input type="checkbox" id="orcamentoServicoRedesSociais" value="redes_sociais" onchange="toggleSubmenu('orcamento', 'redes_sociais')">
                                <label for="orcamentoServicoRedesSociais" style="font-weight: 600;">Redes Sociais</label>
                            </div>
                            <div class="servico-submenu" id="orcamentoSubmenuRedesSociais">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoRedesGestao" value="redes_gestao" onchange="adicionarServicoAoOrcamento('redes_gestao', 'Redes Sociais - Gest√£o')">
                                    <label for="orcamentoRedesGestao">Gest√£o de Redes Sociais</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoRedesCriacao" value="redes_criacao" onchange="adicionarServicoAoOrcamento('redes_criacao', 'Redes Sociais - Cria√ß√£o')">
                                    <label for="orcamentoRedesCriacao">Cria√ß√£o de Redes Sociais</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoRedesPlanejamento" value="redes_planejamento" onchange="adicionarServicoAoOrcamento('redes_planejamento', 'Redes Sociais - Planejamento')">
                                    <label for="orcamentoRedesPlanejamento">Planejamento de Conte√∫do</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoRedesModeracao" value="redes_moderacao" onchange="adicionarServicoAoOrcamento('redes_moderacao', 'Redes Sociais - Modera√ß√£o')">
                                    <label for="orcamentoRedesModeracao">Modera√ß√£o de Coment√°rios</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="orcamentoRedesAnalise" value="redes_analise" onchange="adicionarServicoAoOrcamento('redes_analise', 'Redes Sociais - An√°lise')">
                                    <label for="orcamentoRedesAnalise">An√°lise de M√©tricas</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <small style="color: var(--text-gray); font-size: 12px; margin-top: 8px; display: block;">Selecione os servi√ßos que ser√£o oferecidos neste or√ßamento. Ao marcar um servi√ßo, ele ser√° adicionado automaticamente aos itens do or√ßamento.</small>
                </div>

                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label class="form-label">Itens do Or√ßamento *</label>
                        <button type="button" class="btn btn-secondary" onclick="adicionarItemOrcamento()" style="padding: 6px 12px; font-size: 12px;">+ Adicionar Item Manual</button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table id="orcamentoItensTable" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--tertiary);">
                                    <th style="padding: 8px; text-align: left; font-size: 12px; color: var(--text-gray);">Descri√ß√£o</th>
                                    <th style="padding: 8px; text-align: center; font-size: 12px; color: var(--text-gray); width: 80px;">Qtd</th>
                                    <th style="padding: 8px; text-align: right; font-size: 12px; color: var(--text-gray); width: 100px;">Valor Unit.</th>
                                    <th style="padding: 8px; text-align: right; font-size: 12px; color: var(--text-gray); width: 80px;">Desc. %</th>
                                    <th style="padding: 8px; text-align: right; font-size: 12px; color: var(--text-gray); width: 120px;">Subtotal</th>
                                    <th style="padding: 8px; text-align: center; font-size: 12px; color: var(--text-gray); width: 50px;">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="orcamentoItensBody">
                                <tr>
                                    <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-gray); font-style: italic;">
                                        Nenhum item adicionado. Clique em "Adicionar Item" para come√ßar.
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" style="padding: 8px; text-align: right; font-weight: 600;">Subtotal:</td>
                                    <td id="orcamentoSubtotal" style="padding: 8px; text-align: right; font-weight: 600;">R$ 0,00</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="padding: 8px; text-align: right;">
                                        <input type="number" id="orcamentoDescontoGeral" class="form-input" step="0.01" min="0" placeholder="0.00" style="width: 100px; display: inline-block; margin-left: 8px;" onchange="calcularTotalOrcamento()">
                                        <label style="display: inline-block; margin-left: 4px;">Desconto Geral (R$):</label>
                                    </td>
                                    <td id="orcamentoDescontoGeralValor" style="padding: 8px; text-align: right; color: var(--danger);">R$ 0,00</td>
                                    <td></td>
                                </tr>
                                <tr style="border-top: 2px solid var(--primary);">
                                    <td colspan="4" style="padding: 8px; text-align: right; font-weight: 700; font-size: 16px;">Total:</td>
                                    <td id="orcamentoValorTotal" style="padding: 8px; text-align: right; font-weight: 700; font-size: 16px; color: var(--primary);">R$ 0,00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <input type="hidden" id="orcamentoValor" value="0">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select id="orcamentoStatus" class="form-input" required>
                            <option value="rascunho">Rascunho</option>
                            <option value="enviado">Enviado</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="rejeitado">Rejeitado</option>
                            <option value="expirado">Expirado</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Condi√ß√µes de Pagamento</label>
                    <textarea id="orcamentoCondicoesPagamento" class="form-input" rows="3" style="resize: vertical;" placeholder="Ex: Pagamento √† vista com 5% de desconto, ou parcelado em at√© 3x sem juros..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Forma de Pagamento</label>
                    <div class="checkbox-group" style="background: var(--tertiary); padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="checkbox-item">
                            <input type="checkbox" id="formaPagamentoCartao" value="Cart√£o de Cr√©dito e D√©bito" onchange="atualizarFormaPagamento()">
                            <label for="formaPagamentoCartao">Cart√£o de Cr√©dito e D√©bito</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="formaPagamentoPix" value="PIX" onchange="atualizarFormaPagamento()">
                            <label for="formaPagamentoPix">PIX</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="formaPagamentoDinheiro" value="Dinheiro" onchange="atualizarFormaPagamento()">
                            <label for="formaPagamentoDinheiro">Dinheiro</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="formaPagamentoBoleto" value="Boleto" onchange="atualizarFormaPagamento()">
                            <label for="formaPagamentoBoleto">Boleto</label>
                        </div>
                    </div>
                    <input type="hidden" id="orcamentoFormaPagamento" value="">
                </div>

                <div class="form-group">
                    <label class="form-label">Prazo de Entrega</label>
                    <input type="text" id="orcamentoPrazoEntrega" class="form-input" placeholder="Ex: 30 dias corridos ap√≥s aprova√ß√£o...">
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea id="orcamentoObservacoes" class="form-input" rows="3" style="resize: vertical;" placeholder="Observa√ß√µes adicionais..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeOrcamentoModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalhes Or√ßamento -->
    <div id="orcamentoDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Detalhes do Or√ßamento</h2>
                <button class="btn-close" onclick="closeOrcamentoDetailsModal()">&times;</button>
            </div>
            <div id="orcamentoDetailsContent" style="color: var(--text);">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
            <div class="modal-actions">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button type="button" class="btn btn-secondary" onclick="closeOrcamentoDetailsModal()">Fechar</button>
                    <button type="button" class="btn btn-primary" id="downloadPDFBtn" style="background: var(--danger); border-color: var(--danger);">üìÑ Baixar PDF</button>
                    <button type="button" class="btn btn-primary" id="aprovarOrcamentoBtn" style="background: var(--success); border-color: var(--success); display: none;">‚úì Aprovar</button>
                    <button type="button" class="btn btn-primary" id="recusarOrcamentoBtn" style="background: var(--danger); border-color: var(--danger); display: none;">‚úó Recusar</button>
                    <button type="button" class="btn btn-primary" id="criarProjetoBtn" style="background: var(--primary); border-color: var(--primary); display: none;">üìÅ Criar Projeto</button>
                    <button type="button" class="btn btn-primary" id="editOrcamentoFromDetailsBtn" onclick="">Editar</button>
                    <button type="button" class="btn btn-danger" id="deleteOrcamentoFromDetailsBtn" onclick="">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- jsPDF para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = 'https://zhzhpctsndrcedukivhk.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpoemhwY3RzbmRyY2VkdWtpdmhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5OTA2NjMsImV4cCI6MjA3ODU2NjY2M30.POJaM5AK2RPvczhIAPEjA7bvLxQxnN9rJC4f_oR5bC8';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Verificar se usu√°rio est√° logado (localStorage)
        function checkAuth() {
            const loggedIn = localStorage.getItem('loggedIn');
            if (loggedIn === 'true') {
                showDashboard();
                loadDashboardData();
            } else {
                showLogin();
            }
        }

        // Fun√ß√µes auxiliares globais
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('pt-BR');
            } catch {
                return dateStr;
            }
        }

        function formatCurrency(value) {
            if (!value && value !== 0) return 'R$ 0,00';
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Mostrar p√°gina de login
        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboardPage').classList.remove('active');
        }

        // Mostrar dashboard
        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboardPage').classList.add('active');
            
            // Informa√ß√µes do usu√°rio do localStorage
            const nome = localStorage.getItem('userName') || 'Usu√°rio';
            const email = localStorage.getItem('userEmail') || '';
            
            document.getElementById('userName').textContent = nome;
            document.getElementById('userEmail').textContent = email;
            document.getElementById('userAvatar').textContent = nome.charAt(0).toUpperCase();
        }

        // Login - Buscar na tabela usuarios
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const senha = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');
            
            if (!nome || !senha) {
                errorMessage.textContent = 'Preencha nome e senha';
                errorMessage.classList.add('show');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span>Entrando...</span>';
            errorMessage.classList.remove('show');
            
            try {
                // Buscar na tabela usuarios (aceita mai√∫sculas/min√∫sculas)
                const { data, error } = await supabase
                    .from('usuarios')
                    .select('*')
                    .ilike('nome', nome)  // Case insensitive
                    .eq('senha', senha)
                    .eq('ativo', true)
                    .maybeSingle();
                
                if (error) {
                    console.error('Erro ao buscar usu√°rio:', error);
                    // Se for erro 404 ou 406, a tabela n√£o existe ou n√£o tem acesso
                    if (error.code === 'PGRST116' || error.message?.includes('permission denied')) {
                        throw new Error('Tabela usuarios n√£o configurada. Execute o SQL no Supabase.');
                    }
                    throw new Error('Erro ao conectar com o banco de dados');
                }
                
                if (!data) {
                    throw new Error('Nome ou senha incorretos');
                }
                
                // Login v√°lido
                localStorage.setItem('loggedIn', 'true');
                localStorage.setItem('userName', data.nome);
                localStorage.setItem('userEmail', data.email || '');
                localStorage.setItem('userPerfil', data.perfil || '');
                
                showDashboard();
                loadDashboardData();
            } catch (error) {
                errorMessage.textContent = error.message || 'Nome ou senha incorretos';
                errorMessage.classList.add('show');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<span>Entrar</span>';
            }
        });

        // Logout
        function logout() {
            if (confirm('Deseja realmente sair?')) {
                localStorage.removeItem('loggedIn');
                showLogin();
            }
        }

        // Carregar dados do dashboard
        async function loadDashboardData() {
            try {
                // Buscar pagamentos
                let pagamentos = [];
                try {
                    const { data, error } = await supabase
                        .from('pagamentos')
                        .select('*')
                        .eq('tipo', 'receber');
                    
                    if (!error && data) {
                        pagamentos = data;
                    }
                } catch (e) {
                    // Tabela n√£o existe ou erro, continuar
                }

                // Calcular totais
                const hoje = new Date();
                const mesAtual = hoje.getMonth();
                const anoAtual = hoje.getFullYear();
                
                let faturamentoMes = 0;
                let pagamentosPendentes = 0;
                let pagamentosVencidos = 0;

                if (pagamentos && pagamentos.length > 0) {
                    pagamentos.forEach(p => {
                        const dataVenc = new Date(p.data_vencimento);
                        const valor = parseFloat(p.valor) || 0;
                        
                        if (p.status === 'pago' && dataVenc.getMonth() === mesAtual && dataVenc.getFullYear() === anoAtual) {
                            faturamentoMes += valor;
                        }
                        
                        if (p.status === 'pendente') {
                            pagamentosPendentes += valor;
                        }
                        
                        if (p.status === 'atrasado') {
                            pagamentosVencidos += valor;
                        }
                    });
                }

                // Buscar projetos
                let projetos = [];
                try {
                    const { data, error } = await supabase
                        .from('projetos')
                        .select('*')
                        .eq('status', 'em_andamento');
                    
                    if (!error && data) {
                        projetos = data;
                    }
                } catch (e) {
                    // Tabela n√£o existe ou erro, continuar
                }

                // Atualizar UI
                document.getElementById('faturamentoMes').textContent = formatCurrency(faturamentoMes);
                document.getElementById('projetosAtivos').textContent = projetos?.length || 0;
                document.getElementById('pagamentosPendentes').textContent = formatCurrency(pagamentosPendentes);
                document.getElementById('pagamentosVencidos').textContent = formatCurrency(pagamentosVencidos);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        // Formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Mapeamento de t√≠tulos das p√°ginas
        const pageTitles = {
            'dashboard': 'Dashboard',
            'clientes': 'Clientes',
            'projetos': 'Projetos',
            'orcamentos': 'Or√ßamentos',
            'financeiro': 'Financeiro',
            'plataformas': 'Plataformas'
        };

        // Navega√ß√£o do menu
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remover active de todos
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                // Adicionar active no clicado
                item.classList.add('active');
                
                // Esconder todos os conte√∫dos
                document.querySelectorAll('.page-content').forEach(c => c.style.display = 'none');
                
                // Mostrar conte√∫do correspondente
                const page = item.dataset.page;
                const contentId = page + 'Content';
                const content = document.getElementById(contentId);
                
                // Atualizar t√≠tulo do header
                const headerTitle = document.querySelector('.header-title');
                if (headerTitle && pageTitles[page]) {
                    headerTitle.textContent = pageTitles[page];
                }
                
                if (content) {
                    content.style.display = 'block';
                    
                    // Carregar dados quando abrir a p√°gina
                    if (page === 'clientes') {
                        loadClientes();
                    } else if (page === 'projetos') {
                        loadProjetos();
                    } else if (page === 'orcamentos') {
                        loadOrcamentos();
                    }
                }
                
                // Atualizar t√≠tulo do header
                const titles = {
                    dashboard: 'Dashboard',
                    clientes: 'Clientes',
                    projetos: 'Projetos',
                    orcamentos: 'Or√ßamentos',
                    financeiro: 'Financeiro',
                    plataformas: 'Plataformas'
                };
                document.querySelector('.header-title').textContent = titles[page] || 'Dashboard';
            });
        });

        // ========== CRUD CLIENTES ==========
        let allClientes = [];
        let filteredClientes = [];

        // Carregar clientes do Supabase
        async function loadClientes() {
            const loading = document.getElementById('clientesLoading');
            const table = document.getElementById('clientesTable');
            const empty = document.getElementById('clientesEmpty');
            
            loading.classList.add('active');
            table.style.display = 'none';
            empty.style.display = 'none';

            try {
                // Buscar usu√°rio logado (simulado - usar ID do localStorage se tiver)
                const { data, error } = await supabase
                    .from('clientes')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allClientes = data || [];
                filteredClientes = [...allClientes];
                renderClientes();
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                allClientes = [];
                filteredClientes = [];
                renderClientes();
            } finally {
                loading.classList.remove('active');
            }
        }

        // Renderizar tabela de clientes
        function renderClientes() {
            const tbody = document.getElementById('clientesTableBody');
            const table = document.getElementById('clientesTable');
            const empty = document.getElementById('clientesEmpty');

            if (filteredClientes.length === 0) {
                table.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            empty.style.display = 'none';

            tbody.innerHTML = filteredClientes.map(cliente => {
                const cidadeEstado = [cliente.cidade, cliente.estado].filter(Boolean).join('/') || '-';
                
                return `
                    <tr>
                        <td>${cliente.nome || ''}</td>
                        <td>${cliente.empresa || '-'}</td>
                        <td>${cliente.email || ''}</td>
                        <td>${cliente.telefone || cliente.whatsapp || '-'}</td>
                        <td>${cidadeEstado}</td>
                        <td>
                            <span class="badge ${cliente.status === 'ativo' ? 'badge-ativo' : 'badge-inativo'}">
                                ${cliente.status === 'ativo' ? 'Ativo' : 'Inativo'}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action" onclick="viewClienteDetails('${cliente.id}')" style="border-color: var(--primary); color: var(--primary); margin-right: 8px;">Ver Detalhes</button>
                            <button class="btn-action" onclick="criarOrcamentoParaCliente('${cliente.id}')" style="border-color: var(--success); color: var(--success);">üìÑ Novo Or√ßamento</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filtrar clientes
        function filterClientes() {
            const search = document.getElementById('clienteSearch').value.toLowerCase();
            const statusFilter = document.getElementById('clienteStatusFilter').value;

            filteredClientes = allClientes.filter(cliente => {
                const matchSearch = !search || 
                    (cliente.nome && cliente.nome.toLowerCase().includes(search)) ||
                    (cliente.empresa && cliente.empresa.toLowerCase().includes(search)) ||
                    (cliente.email && cliente.email.toLowerCase().includes(search));
                
                const matchStatus = !statusFilter || cliente.status === statusFilter;
                
                return matchSearch && matchStatus;
            });

            renderClientes();
        }

        // Toggle submenu de servi√ßos
        function toggleSubmenu(servico) {
            // Mapear nomes para IDs corretos
            const idMap = {
                'automacao': { main: 'servicoAutomacao', sub: 'submenuAutomacao' },
                'site': { main: 'servicoSite', sub: 'submenuSite' },
                'trafego': { main: 'servicoTrafego', sub: 'submenuTrafego' },
                'design': { main: 'servicoDesign', sub: 'submenuDesign' },
                'redes_sociais': { main: 'servicoRedesSociais', sub: 'submenuRedesSociais' }
            };
            
            const ids = idMap[servico];
            if (!ids) return;
            
            const checkbox = document.getElementById(ids.main);
            const submenu = document.getElementById(ids.sub);
            
            if (checkbox && submenu) {
                if (checkbox.checked) {
                    submenu.classList.add('active');
                } else {
                    submenu.classList.remove('active');
                    // Desmarcar todos os subitens
                    submenu.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                }
            }
        }

        // Abrir modal de cliente (novo)
        function openClienteModal() {
            document.getElementById('clienteModalTitle').textContent = 'Novo Cliente';
            document.getElementById('clienteForm').reset();
            document.getElementById('clienteId').value = '';
            
            // Preencher data de cadastro com hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('clienteDataCadastro').value = hoje;
            
            // Limpar checkboxes principais
            ['servicoAutomacao', 'servicoSite', 'servicoDesign', 'servicoTrafego', 'servicoRedesSociais'].forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = false;
                    // Fechar submenu
                    const servico = id.replace('servico', '').toLowerCase();
                    const submenu = document.getElementById(`submenu${servico.charAt(0).toUpperCase() + servico.slice(1)}`);
                    if (submenu) {
                        submenu.classList.remove('active');
                    }
                }
            });
            
            // Limpar todos os subitens
            document.querySelectorAll('.servico-submenu input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            document.getElementById('clienteModal').classList.add('active');
        }

        // Fechar modal
        function closeClienteModal() {
            document.getElementById('clienteModal').classList.remove('active');
        }

        // Editar cliente
        async function editCliente(id) {
            const cliente = allClientes.find(c => c.id === id);
            if (!cliente) return;

            document.getElementById('clienteModalTitle').textContent = 'Editar Cliente';
            document.getElementById('clienteId').value = cliente.id;
            document.getElementById('clienteNome').value = cliente.nome || '';
            document.getElementById('clienteEmpresa').value = cliente.empresa || '';
            document.getElementById('clienteEmail').value = cliente.email || '';
            document.getElementById('clienteTelefone').value = cliente.telefone || '';
            document.getElementById('clienteWhatsapp').value = cliente.whatsapp || '';
            document.getElementById('clienteCpfCnpj').value = cliente.cpf_cnpj || '';
            document.getElementById('clienteSegmento').value = cliente.segmento || '';
            document.getElementById('clienteEndereco').value = cliente.endereco || '';
            document.getElementById('clienteCidade').value = cliente.cidade || '';
            document.getElementById('clienteEstado').value = cliente.estado || '';
            document.getElementById('clienteCep').value = cliente.cep || '';
            document.getElementById('clienteDataCadastro').value = cliente.data_cadastro ? cliente.data_cadastro.split('T')[0] : '';
            document.getElementById('clienteOrigem').value = cliente.origem || '';
            document.getElementById('clienteStatus').value = cliente.status || 'ativo';
            document.getElementById('clienteObservacoes').value = cliente.observacoes || '';

            document.getElementById('clienteModal').classList.add('active');
        }

        // Salvar cliente (criar ou atualizar)
        document.getElementById('clienteForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('clienteId').value;

            const clienteData = {
                nome: document.getElementById('clienteNome').value.trim(),
                empresa: document.getElementById('clienteEmpresa').value.trim() || null,
                email: document.getElementById('clienteEmail').value.trim(),
                telefone: document.getElementById('clienteTelefone').value.trim() || null,
                whatsapp: document.getElementById('clienteWhatsapp').value.trim() || null,
                cpf_cnpj: document.getElementById('clienteCpfCnpj').value.trim() || null,
                segmento: document.getElementById('clienteSegmento').value.trim() || null,
                endereco: document.getElementById('clienteEndereco').value.trim() || null,
                cidade: document.getElementById('clienteCidade').value.trim() || null,
                estado: document.getElementById('clienteEstado').value || null,
                cep: document.getElementById('clienteCep').value.trim() || null,
                data_cadastro: document.getElementById('clienteDataCadastro').value || null,
                origem: document.getElementById('clienteOrigem').value || null,
                status: document.getElementById('clienteStatus').value,
                observacoes: document.getElementById('clienteObservacoes').value.trim() || null
            };

            try {
                if (id) {
                    // Atualizar
                    const { error } = await supabase
                        .from('clientes')
                        .update(clienteData)
                        .eq('id', id);

                    if (error) throw error;
                    alert('Cliente atualizado com sucesso!');
                } else {
                    // Criar - sem user_id (removido foreign key constraint)
                    const { error } = await supabase
                        .from('clientes')
                        .insert([clienteData]);

                    if (error) throw error;
                    alert('Cliente criado com sucesso!');
                }

                closeClienteModal();
                loadClientes();
            } catch (error) {
                console.error('Erro ao salvar cliente:', error);
                alert('Erro ao salvar cliente: ' + (error.message || 'Erro desconhecido'));
            }
        });

        // Excluir cliente
        async function deleteCliente(id) {
            if (!confirm('Tem certeza que deseja excluir este cliente?')) return;

            try {
                const { error } = await supabase
                    .from('clientes')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                alert('Cliente exclu√≠do com sucesso!');
                loadClientes();
            } catch (error) {
                console.error('Erro ao excluir cliente:', error);
                alert('Erro ao excluir cliente: ' + (error.message || 'Erro desconhecido'));
            }
        }

        // Ver detalhes do cliente
        function viewClienteDetails(id) {
            const cliente = allClientes.find(c => c.id === id);
            if (!cliente) {
                alert('Cliente n√£o encontrado');
                return;
            }

            const content = document.getElementById('clienteDetailsContent');
            const editBtn = document.getElementById('editFromDetailsBtn');
            const deleteBtn = document.getElementById('deleteFromDetailsBtn');
            
            // Configurar bot√£o de editar
            editBtn.onclick = () => {
                closeClienteDetailsModal();
                editCliente(id);
            };

            // Configurar bot√£o de excluir com confirma√ß√£o
            deleteBtn.onclick = async () => {
                if (!confirm('Tem certeza que deseja excluir este cliente? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('clientes')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    
                    alert('Cliente exclu√≠do com sucesso!');
                    closeClienteDetailsModal();
                    loadClientes();
                } catch (error) {
                    console.error('Erro ao excluir cliente:', error);
                    alert('Erro ao excluir cliente: ' + (error.message || 'Erro desconhecido'));
                }
            };

            // Formatar servi√ßos
            const servicos = cliente.servicos_contratados || [];
            const servicosHtml = servicos.length > 0
                ? servicos.map(s => {
                    // Formatar nome do servi√ßo
                    const nomeFormatado = s
                        .replace(/_/g, ' ')
                        .split(' ')
                        .map(p => p.charAt(0).toUpperCase() + p.slice(1))
                        .join(' ');
                    return `<span class="servico-badge">${nomeFormatado}</span>`;
                }).join('')
                : '<span class="details-value empty">Nenhum servi√ßo contratado</span>';

            // Formatar origem
            const origemMap = {
                'indicacao': 'Indica√ß√£o',
                'google': 'Google',
                'facebook': 'Facebook',
                'instagram': 'Instagram',
                'linkedin': 'LinkedIn',
                'site': 'Site pr√≥prio',
                'outro': 'Outro'
            };
            const origemFormatada = origemMap[cliente.origem] || cliente.origem || '-';

            // Formatar data
            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                try {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('pt-BR');
                } catch {
                    return dateStr;
                }
            };

            // Helper para exibir valor ou "-"
            const displayValue = (value) => value || '<span class="empty">-</span>';

            content.innerHTML = `
                <div class="details-section">
                    <div class="details-section-title">Informa√ß√µes B√°sicas</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">Nome</div>
                            <div class="details-value">${cliente.nome || '-'}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Empresa</div>
                            <div class="details-value">${displayValue(cliente.empresa)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Email</div>
                            <div class="details-value">${cliente.email || '-'}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Status</div>
                            <div class="details-value">
                                <span class="badge ${cliente.status === 'ativo' ? 'badge-ativo' : 'badge-inativo'}">
                                    ${cliente.status === 'ativo' ? 'Ativo' : 'Inativo'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Contato</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">Telefone</div>
                            <div class="details-value">${displayValue(cliente.telefone)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">WhatsApp</div>
                            <div class="details-value">${displayValue(cliente.whatsapp)}</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Documentos e Segmento</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">CPF/CNPJ</div>
                            <div class="details-value">${displayValue(cliente.cpf_cnpj)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Segmento</div>
                            <div class="details-value">${displayValue(cliente.segmento)}</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Endere√ßo</div>
                    <div class="details-grid">
                        <div class="details-item" style="grid-column: 1 / -1;">
                            <div class="details-label">Endere√ßo Completo</div>
                            <div class="details-value">${displayValue(cliente.endereco)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Cidade</div>
                            <div class="details-value">${displayValue(cliente.cidade)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Estado</div>
                            <div class="details-value">${displayValue(cliente.estado)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">CEP</div>
                            <div class="details-value">${displayValue(cliente.cep)}</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Servi√ßos Contratados</div>
                    <div class="servicos-list">
                        ${servicosHtml}
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Informa√ß√µes Adicionais</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">Data de Cadastro</div>
                            <div class="details-value">${formatDate(cliente.data_cadastro)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Origem do Cliente</div>
                            <div class="details-value">${origemFormatada}</div>
                        </div>
                    </div>
                    <div class="details-item" style="margin-top: 12px;">
                        <div class="details-label">Observa√ß√µes</div>
                        <div class="details-value" style="white-space: pre-wrap;">${displayValue(cliente.observacoes)}</div>
                    </div>
                </div>
            `;

            document.getElementById('clienteDetailsModal').classList.add('active');
        }

        // Fechar modal de detalhes
        function closeClienteDetailsModal() {
            document.getElementById('clienteDetailsModal').classList.remove('active');
        }

        // ========== CRUD PROJETOS ==========
        let allProjetos = [];
        let filteredProjetos = [];

        // Carregar projetos do Supabase
        async function loadProjetos() {
            const loading = document.getElementById('projetosLoading');
            const table = document.getElementById('projetosTable');
            const empty = document.getElementById('projetosEmpty');
            
            loading.classList.add('active');
            table.style.display = 'none';
            empty.style.display = 'none';

            try {
                // Buscar projetos
                const { data: projetosData, error: projetosError } = await supabase
                    .from('projetos')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (projetosError) throw projetosError;

                // Buscar clientes
                let clientesMap = {};
                try {
                    const { data: clientesData, error: clientesError } = await supabase
                        .from('clientes')
                        .select('id, nome, empresa');

                    if (!clientesError && clientesData) {
                        clientesData.forEach(cliente => {
                            clientesMap[cliente.id] = cliente;
                        });
                    }
                } catch (e) {
                    console.warn('Erro ao carregar clientes para projetos:', e);
                }

                // Buscar usu√°rios (respons√°veis)
                let usuariosMap = {};
                try {
                    const { data: usuariosData, error: usuariosError } = await supabase
                        .from('usuarios')
                        .select('id, nome');

                    if (!usuariosError && usuariosData) {
                        usuariosData.forEach(usuario => {
                            usuariosMap[usuario.id] = usuario;
                        });
                    }
                } catch (e) {
                    console.warn('Erro ao carregar usu√°rios para projetos:', e);
                }

                // Combinar dados
                allProjetos = (projetosData || []).map(projeto => ({
                    ...projeto,
                    cliente: clientesMap[projeto.cliente_id] || null,
                    responsavel: usuariosMap[projeto.responsavel_id] || null
                }));

                filteredProjetos = [...allProjetos];
                renderProjetos();
            } catch (error) {
                console.error('Erro ao carregar projetos:', error);
                allProjetos = [];
                filteredProjetos = [];
                renderProjetos();
            } finally {
                loading.classList.remove('active');
            }
        }

        // Renderizar tabela de projetos
        function renderProjetos() {
            const tbody = document.getElementById('projetosTableBody');
            const table = document.getElementById('projetosTable');
            const empty = document.getElementById('projetosEmpty');

            if (filteredProjetos.length === 0) {
                table.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            empty.style.display = 'none';

            tbody.innerHTML = filteredProjetos.map(projeto => {
                const cliente = projeto.cliente || {};
                const clienteNome = cliente.nome || cliente.empresa || 'Cliente n√£o encontrado';
                
                const formatDate = (dateStr) => {
                    if (!dateStr) return '-';
                    try {
                        const date = new Date(dateStr);
                        return date.toLocaleDateString('pt-BR');
                    } catch {
                        return dateStr;
                    }
                };

                const formatCurrency = (value) => {
                    if (!value) return 'R$ 0,00';
                    return new Intl.NumberFormat('pt-BR', {
                        style: 'currency',
                        currency: 'BRL'
                    }).format(value);
                };

                const statusMap = {
                    'planejamento': { label: 'Planejamento', class: 'badge-planejamento' },
                    'em_andamento': { label: 'Em Andamento', class: 'badge-em-andamento' },
                    'pausado': { label: 'Pausado', class: 'badge-pausado' },
                    'concluido': { label: 'Conclu√≠do', class: 'badge-concluido' },
                    'cancelado': { label: 'Cancelado', class: 'badge-cancelado' }
                };

                const status = statusMap[projeto.status] || { label: projeto.status, class: 'badge-planejamento' };

                return `
                    <tr>
                        <td>${projeto.nome || ''}</td>
                        <td>${clienteNome}</td>
                        <td>${formatDate(projeto.data_inicio)}</td>
                        <td>${formatDate(projeto.data_prevista)}</td>
                        <td>${formatCurrency(projeto.valor)}</td>
                        <td>
                            <span class="badge ${status.class}">
                                ${status.label}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action" onclick="viewProjetoDetails('${projeto.id}')" style="border-color: var(--primary); color: var(--primary);">Ver Detalhes</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filtrar projetos
        function filterProjetos() {
            const search = document.getElementById('projetoSearch').value.toLowerCase();
            const statusFilter = document.getElementById('projetoStatusFilter').value;

            filteredProjetos = allProjetos.filter(projeto => {
                const cliente = projeto.cliente || {};
                const clienteNome = (cliente.nome || cliente.empresa || '').toLowerCase();
                
                const matchSearch = !search || 
                    (projeto.nome && projeto.nome.toLowerCase().includes(search)) ||
                    clienteNome.includes(search);
                
                const matchStatus = !statusFilter || projeto.status === statusFilter;
                
                return matchSearch && matchStatus;
            });

            renderProjetos();
        }

        // Carregar clientes no select
        async function loadClientesForSelect() {
            try {
                const { data, error } = await supabase
                    .from('clientes')
                    .select('id, nome, empresa')
                    .eq('status', 'ativo')
                    .order('nome', { ascending: true });

                if (error) throw error;

                const select = document.getElementById('projetoClienteId');
                select.innerHTML = '<option value="">Selecione um cliente</option>';
                
                (data || []).forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.empresa ? `${cliente.nome} - ${cliente.empresa}` : cliente.nome;
                    select.appendChild(option);
                });

                // Remover listeners antigos e adicionar novo listener para carregar servi√ßos quando cliente for selecionado
                const newSelect = select.cloneNode(true);
                select.parentNode.replaceChild(newSelect, select);
                document.getElementById('projetoClienteId').addEventListener('change', async (e) => {
                    const clienteId = e.target.value;
                    if (clienteId) {
                        await loadServicosCliente(clienteId, 'projeto');
                    } else {
                        clearServicosContainer('projeto');
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }

        // Carregar usu√°rios no select de respons√°vel
        async function loadUsuariosForSelect() {
            try {
                const { data, error } = await supabase
                    .from('usuarios')
                    .select('id, nome')
                    .eq('ativo', true)
                    .order('nome', { ascending: true });

                if (error) throw error;

                const select = document.getElementById('projetoResponsavelId');
                const currentValue = select.value; // Preservar valor atual
                select.innerHTML = '<option value="">Selecione um respons√°vel</option>';
                
                (data || []).forEach(usuario => {
                    const option = document.createElement('option');
                    option.value = usuario.id;
                    option.textContent = usuario.nome;
                    select.appendChild(option);
                });
                
                // Restaurar valor se existir
                if (currentValue) {
                    select.value = currentValue;
                }
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                // Se n√£o conseguir carregar, apenas limpa o select
                const select = document.getElementById('projetoResponsavelId');
                select.innerHTML = '<option value="">Erro ao carregar usu√°rios</option>';
            }
        }

        // Abrir modal de projeto (novo)
        async function openProjetoModal() {
            document.getElementById('projetoModalTitle').textContent = 'Novo Projeto';
            document.getElementById('projetoForm').reset();
            document.getElementById('projetoId').value = '';
            
            // Preencher data de in√≠cio com hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('projetoDataInicio').value = hoje;
            
            // Carregar clientes e usu√°rios nos selects
            await Promise.all([
                loadClientesForSelect(),
                loadUsuariosForSelect()
            ]);
            
            document.getElementById('projetoModal').classList.add('active');
        }

        // Fechar modal
        function closeProjetoModal() {
            document.getElementById('projetoModal').classList.remove('active');
        }

        // Editar projeto
        async function editProjeto(id) {
            const projeto = allProjetos.find(p => p.id === id);
            if (!projeto) return;

            document.getElementById('projetoModalTitle').textContent = 'Editar Projeto';
            document.getElementById('projetoId').value = projeto.id;
            document.getElementById('projetoNome').value = projeto.nome || '';
            document.getElementById('projetoStatus').value = projeto.status || 'planejamento';
            document.getElementById('projetoPrioridade').value = projeto.prioridade || '';
            document.getElementById('projetoDataInicio').value = projeto.data_inicio ? projeto.data_inicio.split('T')[0] : '';
            document.getElementById('projetoDataPrevista').value = projeto.data_prevista ? projeto.data_prevista.split('T')[0] : '';
            document.getElementById('projetoDataConclusao').value = projeto.data_conclusao ? projeto.data_conclusao.split('T')[0] : '';
            document.getElementById('projetoValor').value = projeto.valor || '';
            document.getElementById('projetoDescricao').value = projeto.descricao || '';
            document.getElementById('projetoObservacoes').value = projeto.observacoes || '';
            
            // Tags - converter array para string separada por v√≠rgula
            if (projeto.tags && Array.isArray(projeto.tags)) {
                document.getElementById('projetoTags').value = projeto.tags.join(', ');
            } else if (typeof projeto.tags === 'string') {
                document.getElementById('projetoTags').value = projeto.tags;
            } else {
                document.getElementById('projetoTags').value = '';
            }

            // Carregar clientes e usu√°rios, depois selecionar valores
            await Promise.all([
                loadClientesForSelect(),
                loadUsuariosForSelect()
            ]);
            
            const clienteId = projeto.cliente_id || '';
            document.getElementById('projetoClienteId').value = clienteId;
            document.getElementById('projetoResponsavelId').value = projeto.responsavel_id || '';

            document.getElementById('projetoModal').classList.add('active');
        }

        // Salvar projeto (criar ou atualizar)
        document.getElementById('projetoForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('projetoId').value;

            // Construir objeto apenas com campos preenchidos
            const projetoData = {
                nome: document.getElementById('projetoNome').value.trim(),
                cliente_id: document.getElementById('projetoClienteId').value,
                status: document.getElementById('projetoStatus').value
            };

            // Adicionar campos opcionais apenas se preenchidos
            const prioridade = document.getElementById('projetoPrioridade').value;
            if (prioridade) projetoData.prioridade = prioridade;

            const responsavelId = document.getElementById('projetoResponsavelId').value;
            if (responsavelId) projetoData.responsavel_id = responsavelId;

            const dataInicio = document.getElementById('projetoDataInicio').value;
            if (dataInicio) projetoData.data_inicio = dataInicio;

            const dataPrevista = document.getElementById('projetoDataPrevista').value;
            if (dataPrevista) projetoData.data_prevista = dataPrevista;

            // Data de conclus√£o - ser√° adicionada se preenchida
            const dataConclusao = document.getElementById('projetoDataConclusao').value;
            if (dataConclusao) projetoData.data_conclusao = dataConclusao;

            const valor = document.getElementById('projetoValor').value;
            if (valor) projetoData.valor = parseFloat(valor);

            // Tags - processar string separada por v√≠rgula e converter para array
            const tagsInput = document.getElementById('projetoTags').value.trim();
            if (tagsInput) {
                const tagsArray = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
                projetoData.tags = tagsArray;
            }

            const descricao = document.getElementById('projetoDescricao').value.trim();
            if (descricao) projetoData.descricao = descricao;

            const observacoes = document.getElementById('projetoObservacoes').value.trim();
            if (observacoes) projetoData.observacoes = observacoes;

            try {
                if (id) {
                    // Atualizar
                    const { error } = await supabase
                        .from('projetos')
                        .update(projetoData)
                        .eq('id', id);

                    if (error) throw error;
                    alert('Projeto atualizado com sucesso!');
                } else {
                    // Criar
                    const { error } = await supabase
                        .from('projetos')
                        .insert([projetoData]);

                    if (error) throw error;
                    alert('Projeto criado com sucesso!');
                }

                closeProjetoModal();
                loadProjetos();
                loadDashboardData(); // Atualizar dashboard
            } catch (error) {
                console.error('Erro ao salvar projeto:', error);
                
                // Mensagem de erro mais amig√°vel
                let errorMessage = 'Erro ao salvar projeto: ' + (error.message || 'Erro desconhecido');
                
                // Se o erro for sobre coluna n√£o encontrada, orientar o usu√°rio
                if (error.message && error.message.includes('column') && error.message.includes('schema cache')) {
                    errorMessage = 'Erro: A estrutura da tabela "projetos" est√° incompleta.\n\n' +
                                 'Por favor, execute o script SQL (supabase_schema.sql) no Supabase para criar todas as colunas necess√°rias.\n\n' +
                                 'Erro t√©cnico: ' + error.message;
                }
                
                alert(errorMessage);
            }
        });

        // Ver detalhes do projeto
        function viewProjetoDetails(id) {
            const projeto = allProjetos.find(p => p.id === id);
            if (!projeto) {
                alert('Projeto n√£o encontrado');
                return;
            }

            const content = document.getElementById('projetoDetailsContent');
            const editBtn = document.getElementById('editProjetoFromDetailsBtn');
            const deleteBtn = document.getElementById('deleteProjetoFromDetailsBtn');
            
            // Configurar bot√£o de editar
            editBtn.onclick = () => {
                closeProjetoDetailsModal();
                editProjeto(id);
            };

            // Configurar bot√£o de excluir com confirma√ß√£o
            deleteBtn.onclick = async () => {
                if (!confirm('Tem certeza que deseja excluir este projeto? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('projetos')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    
                    alert('Projeto exclu√≠do com sucesso!');
                    closeProjetoDetailsModal();
                    loadProjetos();
                    loadDashboardData(); // Atualizar dashboard
                } catch (error) {
                    console.error('Erro ao excluir projeto:', error);
                    alert('Erro ao excluir projeto: ' + (error.message || 'Erro desconhecido'));
                }
            };

            const cliente = projeto.cliente || {};
            const clienteNome = cliente.nome || cliente.empresa || 'Cliente n√£o encontrado';

            // Formatar data
            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                try {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('pt-BR');
                } catch {
                    return dateStr;
                }
            };

            // Formatar moeda
            const formatCurrency = (value) => {
                if (!value) return 'R$ 0,00';
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(value);
            };

            // Status
            const statusMap = {
                'planejamento': { label: 'Planejamento', class: 'badge-planejamento' },
                'em_andamento': { label: 'Em Andamento', class: 'badge-em-andamento' },
                'pausado': { label: 'Pausado', class: 'badge-pausado' },
                'concluido': { label: 'Conclu√≠do', class: 'badge-concluido' },
                'cancelado': { label: 'Cancelado', class: 'badge-cancelado' }
            };

            const status = statusMap[projeto.status] || { label: projeto.status, class: 'badge-planejamento' };

            // Prioridade
            const prioridadeMap = {
                'baixa': { label: 'Baixa', class: 'badge-prioridade-baixa' },
                'media': { label: 'M√©dia', class: 'badge-prioridade-media' },
                'alta': { label: 'Alta', class: 'badge-prioridade-alta' },
                'urgente': { label: 'Urgente', class: 'badge-prioridade-urgente' }
            };
            const prioridade = prioridadeMap[projeto.prioridade] || null;

            // Respons√°vel
            const responsavel = projeto.responsavel || {};
            const responsavelNome = responsavel.nome || '-';

            // Tags
            let tagsHtml = '<span class="details-value empty">Nenhuma tag</span>';
            if (projeto.tags) {
                let tagsArray = [];
                if (Array.isArray(projeto.tags)) {
                    tagsArray = projeto.tags;
                } else if (typeof projeto.tags === 'string') {
                    tagsArray = projeto.tags.split(',').map(t => t.trim()).filter(t => t.length > 0);
                }
                
                if (tagsArray.length > 0) {
                    tagsHtml = tagsArray.map(tag => 
                        `<span class="tag-badge">${tag}</span>`
                    ).join('');
                }
            }

            // Helper para exibir valor ou "-"
            const displayValue = (value) => value || '<span class="empty">-</span>';

            content.innerHTML = `
                <div class="details-section">
                    <div class="details-section-title">Informa√ß√µes B√°sicas</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">Nome do Projeto</div>
                            <div class="details-value">${projeto.nome || '-'}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Cliente</div>
                            <div class="details-value">${clienteNome}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Status</div>
                            <div class="details-value">
                                <span class="badge ${status.class}">
                                    ${status.label}
                                </span>
                            </div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Prioridade</div>
                            <div class="details-value">
                                ${prioridade ? `<span class="badge ${prioridade.class}">${prioridade.label}</span>` : '<span class="empty">-</span>'}
                            </div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Respons√°vel</div>
                            <div class="details-value">${responsavelNome}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Valor do Projeto</div>
                            <div class="details-value">${formatCurrency(projeto.valor)}</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Tags/Categorias</div>
                    <div class="servicos-list">
                        ${tagsHtml}
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Datas</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">Data de In√≠cio</div>
                            <div class="details-value">${formatDate(projeto.data_inicio)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Data Prevista de Conclus√£o</div>
                            <div class="details-value">${formatDate(projeto.data_prevista)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Data de Conclus√£o</div>
                            <div class="details-value">${formatDate(projeto.data_conclusao)}</div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Descri√ß√£o</div>
                    <div class="details-item">
                        <div class="details-value" style="white-space: pre-wrap;">${displayValue(projeto.descricao)}</div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Observa√ß√µes</div>
                    <div class="details-item">
                        <div class="details-value" style="white-space: pre-wrap;">${displayValue(projeto.observacoes)}</div>
                    </div>
                </div>
            `;

            document.getElementById('projetoDetailsModal').classList.add('active');
        }

        // Fechar modal de detalhes
        function closeProjetoDetailsModal() {
            document.getElementById('projetoDetailsModal').classList.remove('active');
        }

        // ========== CRUD OR√áAMENTOS ==========
        let allOrcamentos = [];
        let filteredOrcamentos = [];

        // Carregar or√ßamentos do Supabase
        async function loadOrcamentos() {
            const loading = document.getElementById('orcamentosLoading');
            const table = document.getElementById('orcamentosTable');
            const empty = document.getElementById('orcamentosEmpty');
            
            loading.classList.add('active');
            table.style.display = 'none';
            empty.style.display = 'none';

            try {
                // Buscar or√ßamentos
                const { data: orcamentosData, error: orcamentosError } = await supabase
                    .from('orcamentos')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (orcamentosError) throw orcamentosError;

                // Buscar clientes
                let clientesMap = {};
                try {
                    const { data: clientesData, error: clientesError } = await supabase
                        .from('clientes')
                        .select('id, nome, empresa');

                    if (!clientesError && clientesData) {
                        clientesData.forEach(cliente => {
                            clientesMap[cliente.id] = cliente;
                        });
                    }
                } catch (e) {
                    console.warn('Erro ao carregar clientes para or√ßamentos:', e);
                }

                // Combinar dados
                allOrcamentos = (orcamentosData || []).map(orcamento => ({
                    ...orcamento,
                    cliente: clientesMap[orcamento.cliente_id] || null
                }));

                filteredOrcamentos = [...allOrcamentos];
                renderOrcamentos();
            } catch (error) {
                console.error('Erro ao carregar or√ßamentos:', error);
                allOrcamentos = [];
                filteredOrcamentos = [];
                renderOrcamentos();
            } finally {
                loading.classList.remove('active');
            }
        }

        // Renderizar tabela de or√ßamentos
        function renderOrcamentos() {
            const tbody = document.getElementById('orcamentosTableBody');
            const table = document.getElementById('orcamentosTable');
            const empty = document.getElementById('orcamentosEmpty');

            if (filteredOrcamentos.length === 0) {
                table.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            empty.style.display = 'none';

            tbody.innerHTML = filteredOrcamentos.map(orcamento => {
                const cliente = orcamento.cliente || {};
                const clienteNome = cliente.nome || cliente.empresa || 'Cliente n√£o encontrado';
                
                const formatDate = (dateStr) => {
                    if (!dateStr) return '-';
                    try {
                        const date = new Date(dateStr);
                        return date.toLocaleDateString('pt-BR');
                    } catch {
                        return dateStr;
                    }
                };

                const formatCurrency = (value) => {
                    if (!value) return 'R$ 0,00';
                    return new Intl.NumberFormat('pt-BR', {
                        style: 'currency',
                        currency: 'BRL'
                    }).format(value);
                };

                // Calcular data de validade
                let dataValidade = '-';
                if (orcamento.data && orcamento.validade_dias) {
                    try {
                        const data = new Date(orcamento.data);
                        data.setDate(data.getDate() + parseInt(orcamento.validade_dias));
                        dataValidade = formatDate(data.toISOString());
                    } catch (e) {
                        dataValidade = '-';
                    }
                }

                const statusMap = {
                    'rascunho': { label: 'Rascunho', class: 'badge-rascunho' },
                    'enviado': { label: 'Enviado', class: 'badge-enviado' },
                    'aprovado': { label: 'Aprovado', class: 'badge-aprovado' },
                    'rejeitado': { label: 'Rejeitado', class: 'badge-rejeitado' },
                    'expirado': { label: 'Expirado', class: 'badge-expirado' }
                };

                const status = statusMap[orcamento.status] || { label: orcamento.status, class: 'badge-rascunho' };

                return `
                    <tr>
                        <td>${orcamento.numero || 'N/A'}</td>
                        <td>${clienteNome}</td>
                        <td>${formatDate(orcamento.data)}</td>
                        <td>${formatCurrency(orcamento.valor)}</td>
                        <td>${dataValidade}</td>
                        <td>
                            <span class="badge ${status.class}">
                                ${status.label}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action" onclick="viewOrcamentoDetails('${orcamento.id}')" style="border-color: var(--primary); color: var(--primary); margin-right: 4px;">Ver</button>
                            ${orcamento.status === 'enviado' ? `
                                <button class="btn-action" onclick="aprovarOrcamento('${orcamento.id}')" style="border-color: var(--success); color: var(--success); margin-right: 4px;" title="Aprovar">‚úì</button>
                                <button class="btn-action" onclick="recusarOrcamento('${orcamento.id}')" style="border-color: var(--danger); color: var(--danger);" title="Recusar">‚úó</button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Filtrar or√ßamentos
        function filterOrcamentos() {
            const search = document.getElementById('orcamentoSearch').value.toLowerCase();
            const statusFilter = document.getElementById('orcamentoStatusFilter').value;

            filteredOrcamentos = allOrcamentos.filter(orcamento => {
                const cliente = orcamento.cliente || {};
                const clienteNome = (cliente.nome || cliente.empresa || '').toLowerCase();
                const numero = (orcamento.numero || '').toLowerCase();
                const descricao = (orcamento.descricao || '').toLowerCase();
                
                const matchSearch = !search || 
                    numero.includes(search) ||
                    clienteNome.includes(search) ||
                    descricao.includes(search);
                
                const matchStatus = !statusFilter || orcamento.status === statusFilter;
                
                return matchSearch && matchStatus;
            });

            renderOrcamentos();
        }

        // Abrir modal de or√ßamento (novo)
        async function openOrcamentoModal() {
            await criarOrcamentoParaCliente(null);
        }

        // Criar or√ßamento para um cliente espec√≠fico
        async function criarOrcamentoParaCliente(clienteId) {
            document.getElementById('orcamentoModalTitle').textContent = 'Novo Or√ßamento';
            document.getElementById('orcamentoForm').reset();
            document.getElementById('orcamentoId').value = '';
            
            // Limpar checkboxes de servi√ßos
            document.querySelectorAll('#orcamentoServicosContainer input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            // Fechar todos os submenus
            document.querySelectorAll('#orcamentoServicosContainer .servico-submenu').forEach(submenu => {
                submenu.classList.remove('active');
            });
            
            // Limpar checkboxes de forma de pagamento
            document.getElementById('formaPagamentoCartao').checked = false;
            document.getElementById('formaPagamentoPix').checked = false;
            document.getElementById('formaPagamentoDinheiro').checked = false;
            document.getElementById('formaPagamentoBoleto').checked = false;
            document.getElementById('orcamentoFormaPagamento').value = '';
            
            carregarItensOrcamento([]);
            document.getElementById('orcamentoDescontoGeral').value = '0';
            
            // Preencher data com hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('orcamentoData').value = hoje;
            
            // Gerar n√∫mero do or√ßamento
            try {
                const { data, error } = await supabase
                    .from('orcamentos')
                    .select('numero')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                let proximoNumero = 1;
                if (!error && data && data.length > 0 && data[0].numero) {
                    const ultimoNumero = parseInt(data[0].numero) || 0;
                    proximoNumero = ultimoNumero + 1;
                }
                
                document.getElementById('orcamentoNumero').value = proximoNumero.toString().padStart(4, '0');
            } catch (e) {
                document.getElementById('orcamentoNumero').value = '0001';
            }
            
            // Carregar clientes no select
            await loadClientesForOrcamentoSelect();
            
            // Selecionar cliente se fornecido
            if (clienteId) {
                document.getElementById('orcamentoClienteId').value = clienteId;
            }
            
            document.getElementById('orcamentoModal').classList.add('active');
        }

        // Carregar clientes no select de or√ßamento
        async function loadClientesForOrcamentoSelect() {
            try {
                const { data, error } = await supabase
                    .from('clientes')
                    .select('id, nome, empresa')
                    .eq('status', 'ativo')
                    .order('nome', { ascending: true });

                if (error) throw error;

                const select = document.getElementById('orcamentoClienteId');
                select.innerHTML = '<option value="">Selecione um cliente</option>';
                
                (data || []).forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.empresa ? `${cliente.nome} - ${cliente.empresa}` : cliente.nome;
                    select.appendChild(option);
                });

            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }

        // Atualizar forma de pagamento (coletar checkboxes marcados)
        function atualizarFormaPagamento() {
            const formasSelecionadas = [];
            if (document.getElementById('formaPagamentoCartao').checked) {
                formasSelecionadas.push('Cart√£o de Cr√©dito e D√©bito');
            }
            if (document.getElementById('formaPagamentoPix').checked) {
                formasSelecionadas.push('PIX');
            }
            if (document.getElementById('formaPagamentoDinheiro').checked) {
                formasSelecionadas.push('Dinheiro');
            }
            if (document.getElementById('formaPagamentoBoleto').checked) {
                formasSelecionadas.push('Boleto');
            }
            document.getElementById('orcamentoFormaPagamento').value = formasSelecionadas.join(', ');
        }

        // Fechar modal
        function closeOrcamentoModal() {
            document.getElementById('orcamentoModal').classList.remove('active');
            // Limpar checkboxes de servi√ßos
            document.querySelectorAll('#orcamentoServicosContainer input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            // Fechar todos os submenus
            document.querySelectorAll('#orcamentoServicosContainer .servico-submenu').forEach(submenu => {
                submenu.classList.remove('active');
            });
            // Limpar checkboxes de forma de pagamento
            document.getElementById('formaPagamentoCartao').checked = false;
            document.getElementById('formaPagamentoPix').checked = false;
            document.getElementById('formaPagamentoDinheiro').checked = false;
            document.getElementById('formaPagamentoBoleto').checked = false;
            document.getElementById('orcamentoFormaPagamento').value = '';
        }

        // Editar or√ßamento
        async function editOrcamento(id) {
            const orcamento = allOrcamentos.find(o => o.id === id);
            if (!orcamento) return;

            document.getElementById('orcamentoModalTitle').textContent = 'Editar Or√ßamento';
            document.getElementById('orcamentoId').value = orcamento.id;
            document.getElementById('orcamentoNumero').value = orcamento.numero || '';
            document.getElementById('orcamentoData').value = orcamento.data ? orcamento.data.split('T')[0] : '';
            document.getElementById('orcamentoValidade').value = orcamento.validade_dias || 30;
            document.getElementById('orcamentoDescontoGeral').value = orcamento.desconto_geral || 0;
            document.getElementById('orcamentoStatus').value = orcamento.status || 'rascunho';
            
            // Extrair condi√ß√µes comerciais das observa√ß√µes
            const observacoes = orcamento.observacoes || '';
            let condicoesPagamento = '';
            let formaPagamento = '';
            let prazoEntrega = '';
            let observacoesLimpa = observacoes;
            
            if (observacoes.includes('=== CONDI√á√ïES COMERCIAIS ===')) {
                const partes = observacoes.split('=== CONDI√á√ïES COMERCIAIS ===');
                observacoesLimpa = partes[0].trim();
                const condicoesTexto = partes[1] || '';
                
                // Extrair condi√ß√µes de pagamento
                const matchCondicoes = condicoesTexto.match(/Condi√ß√µes de Pagamento:\s*(.+?)(?:\n|$)/i);
                if (matchCondicoes) condicoesPagamento = matchCondicoes[1].trim();
                
                // Extrair forma de pagamento
                const matchForma = condicoesTexto.match(/Forma de Pagamento:\s*(.+?)(?:\n|$)/i);
                if (matchForma) formaPagamento = matchForma[1].trim();
                
                // Extrair prazo de entrega
                const matchPrazo = condicoesTexto.match(/Prazo de Entrega:\s*(.+?)(?:\n|$)/i);
                if (matchPrazo) prazoEntrega = matchPrazo[1].trim();
            }
            
            document.getElementById('orcamentoCondicoesPagamento').value = condicoesPagamento;
            document.getElementById('orcamentoPrazoEntrega').value = prazoEntrega;
            document.getElementById('orcamentoObservacoes').value = observacoesLimpa;
            
            // Marcar checkboxes de forma de pagamento
            if (formaPagamento) {
                const formas = formaPagamento.split(',').map(f => f.trim());
                document.getElementById('formaPagamentoCartao').checked = formas.includes('Cart√£o de Cr√©dito e D√©bito');
                document.getElementById('formaPagamentoPix').checked = formas.includes('PIX');
                document.getElementById('formaPagamentoDinheiro').checked = formas.includes('Dinheiro');
                document.getElementById('formaPagamentoBoleto').checked = formas.includes('Boleto');
                atualizarFormaPagamento();
            } else {
                document.getElementById('formaPagamentoCartao').checked = false;
                document.getElementById('formaPagamentoPix').checked = false;
                document.getElementById('formaPagamentoDinheiro').checked = false;
                document.getElementById('formaPagamentoBoleto').checked = false;
                document.getElementById('orcamentoFormaPagamento').value = '';
            }

            // Carregar itens
            const itens = orcamento.itens || [];
            carregarItensOrcamento(itens);

            // Carregar clientes e selecionar o cliente do or√ßamento
            await loadClientesForOrcamentoSelect();
            const clienteId = orcamento.cliente_id || '';
            document.getElementById('orcamentoClienteId').value = clienteId;

            document.getElementById('orcamentoModal').classList.add('active');
        }

        // Salvar or√ßamento (criar ou atualizar)
        document.getElementById('orcamentoForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('orcamentoId').value;
            const itens = coletarItensOrcamento();

            if (itens.length === 0) {
                alert('Adicione pelo menos um item ao or√ßamento!');
                return;
            }

            // Coletar condi√ß√µes comerciais para incluir nas observa√ß√µes
            const condicoesPagamento = document.getElementById('orcamentoCondicoesPagamento').value.trim();
            const formaPagamento = document.getElementById('orcamentoFormaPagamento').value.trim();
            const prazoEntrega = document.getElementById('orcamentoPrazoEntrega').value.trim();
            const observacoes = document.getElementById('orcamentoObservacoes').value.trim();
            
            // Montar observa√ß√µes completas incluindo condi√ß√µes comerciais
            let observacoesCompletas = observacoes || '';
            if (condicoesPagamento || formaPagamento || prazoEntrega) {
                if (observacoesCompletas) observacoesCompletas += '\n\n';
                observacoesCompletas += '=== CONDI√á√ïES COMERCIAIS ===\n';
                if (condicoesPagamento) observacoesCompletas += `Condi√ß√µes de Pagamento: ${condicoesPagamento}\n`;
                if (formaPagamento) observacoesCompletas += `Forma de Pagamento: ${formaPagamento}\n`;
                if (prazoEntrega) observacoesCompletas += `Prazo de Entrega: ${prazoEntrega}`;
            }

            const orcamentoData = {
                numero: document.getElementById('orcamentoNumero').value.trim(),
                cliente_id: document.getElementById('orcamentoClienteId').value,
                data: document.getElementById('orcamentoData').value,
                validade_dias: parseInt(document.getElementById('orcamentoValidade').value) || 30,
                valor: parseFloat(document.getElementById('orcamentoValor').value) || 0,
                desconto_geral: parseFloat(document.getElementById('orcamentoDescontoGeral').value) || 0,
                status: document.getElementById('orcamentoStatus').value,
                itens: itens,
                observacoes: observacoesCompletas || null
            };

            try {
                if (id) {
                    // Atualizar
                    const { error } = await supabase
                        .from('orcamentos')
                        .update(orcamentoData)
                        .eq('id', id);

                    if (error) throw error;
                    alert('Or√ßamento atualizado com sucesso!');
                } else {
                    // Criar
                    const { error } = await supabase
                        .from('orcamentos')
                        .insert([orcamentoData]);

                    if (error) throw error;
                    alert('Or√ßamento criado com sucesso!');
                }

                closeOrcamentoModal();
                loadOrcamentos();
                loadDashboardData();
            } catch (error) {
                console.error('Erro ao salvar or√ßamento:', error);
                alert('Erro ao salvar or√ßamento: ' + (error.message || 'Erro desconhecido'));
            }
        });

        // Ver detalhes do or√ßamento
        function viewOrcamentoDetails(id) {
            const orcamento = allOrcamentos.find(o => o.id === id);
            if (!orcamento) {
                alert('Or√ßamento n√£o encontrado');
                return;
            }

            const content = document.getElementById('orcamentoDetailsContent');
            const editBtn = document.getElementById('editOrcamentoFromDetailsBtn');
            const deleteBtn = document.getElementById('deleteOrcamentoFromDetailsBtn');
            
            editBtn.onclick = () => {
                closeOrcamentoDetailsModal();
                editOrcamento(id);
            };

            deleteBtn.onclick = async () => {
                if (!confirm('Tem certeza que deseja excluir este or√ßamento? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    return;
                }

                try {
                    const { error } = await supabase
                        .from('orcamentos')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;
                    
                    alert('Or√ßamento exclu√≠do com sucesso!');
                    closeOrcamentoDetailsModal();
                    loadOrcamentos();
                    loadDashboardData();
                } catch (error) {
                    console.error('Erro ao excluir or√ßamento:', error);
                    alert('Erro ao excluir or√ßamento: ' + (error.message || 'Erro desconhecido'));
                }
            };

            const cliente = orcamento.cliente || {};
            const clienteNome = cliente.nome || cliente.empresa || 'Cliente n√£o encontrado';

            const formatDate = (dateStr) => {
                if (!dateStr) return '-';
                try {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('pt-BR');
                } catch {
                    return dateStr;
                }
            };

            const formatCurrency = (value) => {
                if (!value) return 'R$ 0,00';
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(value);
            };

            // Calcular data de validade
            let dataValidade = '-';
            if (orcamento.data && orcamento.validade_dias) {
                try {
                    const data = new Date(orcamento.data);
                    data.setDate(data.getDate() + parseInt(orcamento.validade_dias));
                    dataValidade = formatDate(data.toISOString());
                } catch (e) {
                    dataValidade = '-';
                }
            }

            const statusMap = {
                'rascunho': { label: 'Rascunho', class: 'badge-rascunho' },
                'enviado': { label: 'Enviado', class: 'badge-enviado' },
                'aprovado': { label: 'Aprovado', class: 'badge-aprovado' },
                'rejeitado': { label: 'Rejeitado', class: 'badge-rejeitado' },
                'expirado': { label: 'Expirado', class: 'badge-expirado' }
            };

            const status = statusMap[orcamento.status] || { label: orcamento.status, class: 'badge-rascunho' };

            const displayValue = (value) => value || '<span class="empty">-</span>';

            // Preparar itens do or√ßamento
            const itens = orcamento.itens || [];
            let itensHtml = '';
            let subtotalItens = 0;

            if (itens.length > 0) {
                itensHtml = '<table style="width: 100%; border-collapse: collapse; margin-top: 12px;">';
                itensHtml += '<thead><tr style="background: var(--tertiary); border-bottom: 1px solid rgba(255,255,255,0.1);">';
                itensHtml += '<th style="padding: 8px; text-align: left; font-size: 12px;">Descri√ß√£o</th>';
                itensHtml += '<th style="padding: 8px; text-align: center; font-size: 12px;">Qtd</th>';
                itensHtml += '<th style="padding: 8px; text-align: right; font-size: 12px;">Valor Unit.</th>';
                itensHtml += '<th style="padding: 8px; text-align: right; font-size: 12px;">Desc. %</th>';
                itensHtml += '<th style="padding: 8px; text-align: right; font-size: 12px;">Subtotal</th>';
                itensHtml += '</tr></thead><tbody>';

                itens.forEach(item => {
                    const itemSubtotal = item.subtotal || 0;
                    subtotalItens += itemSubtotal;
                    itensHtml += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">`;
                    itensHtml += `<td style="padding: 8px;">${item.descricao || '-'}</td>`;
                    itensHtml += `<td style="padding: 8px; text-align: center;">${item.quantidade || 0}</td>`;
                    itensHtml += `<td style="padding: 8px; text-align: right;">${formatCurrency(item.valor_unitario || 0)}</td>`;
                    itensHtml += `<td style="padding: 8px; text-align: right;">${item.desconto_percent || 0}%</td>`;
                    itensHtml += `<td style="padding: 8px; text-align: right; font-weight: 600;">${formatCurrency(itemSubtotal)}</td>`;
                    itensHtml += `</tr>`;
                });

                itensHtml += '</tbody></table>';
            } else {
                itensHtml = '<div style="padding: 20px; text-align: center; color: var(--text-gray); font-style: italic;">Nenhum item cadastrado</div>';
            }

            const descontoGeral = parseFloat(orcamento.desconto_geral || 0);

            content.innerHTML = `
                <div class="details-section">
                    <div class="details-section-title">Informa√ß√µes B√°sicas</div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-label">N√∫mero do Or√ßamento</div>
                            <div class="details-value">${orcamento.numero || '-'}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Cliente</div>
                            <div class="details-value">${clienteNome}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Data do Or√ßamento</div>
                            <div class="details-value">${formatDate(orcamento.data)}</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Validade</div>
                            <div class="details-value">${orcamento.validade_dias || '-'} dias (at√© ${dataValidade})</div>
                        </div>
                        <div class="details-item">
                            <div class="details-label">Status</div>
                            <div class="details-value">
                                <span class="badge ${status.class}">
                                    ${status.label}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Itens do Or√ßamento</div>
                    ${itensHtml}
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">Subtotal:</span>
                            <span style="font-weight: 600;">${formatCurrency(subtotalItens)}</span>
                        </div>
                        ${descontoGeral > 0 ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--danger);">
                            <span>Desconto Geral:</span>
                            <span>${formatCurrency(descontoGeral)}</span>
                        </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700; color: var(--primary); padding-top: 8px; border-top: 2px solid var(--primary);">
                            <span>Total:</span>
                            <span>${formatCurrency(orcamento.valor)}</span>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="details-section-title">Observa√ß√µes</div>
                    <div class="details-item">
                        <div class="details-value" style="white-space: pre-wrap;">${displayValue(orcamento.observacoes)}</div>
                    </div>
                </div>
            `;

            // Configurar bot√µes de a√ß√£o
            document.getElementById('orcamentoDetailsModal').dataset.orcamentoId = id;
            
            const pdfBtn = document.getElementById('downloadPDFBtn');
            pdfBtn.onclick = () => gerarPDFOrcamento();

            const aprovarBtn = document.getElementById('aprovarOrcamentoBtn');
            const recusarBtn = document.getElementById('recusarOrcamentoBtn');
            const criarProjetoBtn = document.getElementById('criarProjetoBtn');
            
            if (orcamento.status === 'enviado') {
                aprovarBtn.style.display = 'inline-block';
                recusarBtn.style.display = 'inline-block';
                aprovarBtn.onclick = () => aprovarOrcamento(id);
                recusarBtn.onclick = () => recusarOrcamento(id);
                criarProjetoBtn.style.display = 'none';
            } else if (orcamento.status === 'aprovado') {
                aprovarBtn.style.display = 'none';
                recusarBtn.style.display = 'none';
                criarProjetoBtn.style.display = 'inline-block';
                criarProjetoBtn.onclick = () => criarProjetoDoOrcamento(id);
            } else {
                aprovarBtn.style.display = 'none';
                recusarBtn.style.display = 'none';
                criarProjetoBtn.style.display = 'none';
            }

            document.getElementById('orcamentoDetailsModal').classList.add('active');
        }

        // Fechar modal de detalhes
        function closeOrcamentoDetailsModal() {
            document.getElementById('orcamentoDetailsModal').classList.remove('active');
        }

        // Criar projeto a partir de or√ßamento aprovado
        async function criarProjetoDoOrcamento(orcamentoId) {
            const orcamento = allOrcamentos.find(o => o.id === orcamentoId);
            if (!orcamento) {
                alert('Or√ßamento n√£o encontrado');
                return;
            }

            if (orcamento.status !== 'aprovado') {
                alert('Apenas or√ßamentos aprovados podem gerar projetos');
                return;
            }

            // Fechar modal de or√ßamento
            closeOrcamentoDetailsModal();

            // Abrir modal de projeto preenchido
            document.getElementById('projetoModalTitle').textContent = 'Novo Projeto (do Or√ßamento)';
            document.getElementById('projetoForm').reset();
            document.getElementById('projetoId').value = '';

            // Preencher dados do or√ßamento
            const clienteNome = orcamento.cliente?.nome || orcamento.cliente?.empresa || 'Cliente do Or√ßamento';
            const nomeProjeto = `Projeto - ${clienteNome} - Or√ßamento ${orcamento.numero || ''}`;
            
            document.getElementById('projetoNome').value = nomeProjeto;
            document.getElementById('projetoClienteId').value = orcamento.cliente_id || '';
            document.getElementById('projetoStatus').value = 'planejamento';
            document.getElementById('projetoValor').value = orcamento.valor || '';

            // Data de in√≠cio com hoje
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('projetoDataInicio').value = hoje;

            // Calcular data prevista (validade do or√ßamento + hoje)
            if (orcamento.validade_dias) {
                const dataPrevista = new Date();
                dataPrevista.setDate(dataPrevista.getDate() + parseInt(orcamento.validade_dias));
                document.getElementById('projetoDataPrevista').value = dataPrevista.toISOString().split('T')[0];
            }

            // Descri√ß√£o com informa√ß√µes do or√ßamento
            let descricao = `Projeto criado a partir do Or√ßamento ${orcamento.numero || ''}.\n\n`;
            descricao += `Itens do or√ßamento:\n`;
            const itens = orcamento.itens || [];
            itens.forEach((item, index) => {
                descricao += `${index + 1}. ${item.descricao || 'Item'} - Qtd: ${item.quantidade || 1} - Valor: R$ ${(item.subtotal || 0).toFixed(2)}\n`;
            });
            descricao += `\nTotal: R$ ${(orcamento.valor || 0).toFixed(2)}`;
            
            if (orcamento.condicoes_pagamento) {
                descricao += `\n\nCondi√ß√µes de Pagamento: ${orcamento.condicoes_pagamento}`;
            }
            if (orcamento.prazo_entrega) {
                descricao += `\nPrazo de Entrega: ${orcamento.prazo_entrega}`;
            }
            if (orcamento.observacoes) {
                descricao += `\n\nObserva√ß√µes do Or√ßamento: ${orcamento.observacoes}`;
            }

            document.getElementById('projetoDescricao').value = descricao;

            // Tags com refer√™ncia ao or√ßamento
            document.getElementById('projetoTags').value = `orcamento-${orcamento.numero || orcamentoId}, aprovado`;

            // Carregar clientes e usu√°rios
            await Promise.all([
                loadClientesForSelect(),
                loadUsuariosForSelect()
            ]);

            // Selecionar cliente
            if (orcamento.cliente_id) {
                document.getElementById('projetoClienteId').value = orcamento.cliente_id;
            }

            // Abrir modal
            document.getElementById('projetoModal').classList.add('active');
        }

        // ========== GERENCIAMENTO DE ITENS DO OR√áAMENTO ==========
        let orcamentoItens = [];
        let itemCounter = 0;

        // Adicionar item ao or√ßamento
        function adicionarItemOrcamento() {
            const tbody = document.getElementById('orcamentoItensBody');
            
            // Remover mensagem de "nenhum item"
            if (tbody.children.length === 1 && tbody.children[0].children.length === 1) {
                tbody.innerHTML = '';
            }

            const itemId = 'item_' + (++itemCounter);
            const row = document.createElement('tr');
            row.id = itemId;
            row.innerHTML = `
                <td data-label="Descri√ß√£o">
                    <input type="text" class="form-input item-descricao" placeholder="Descri√ß√£o do item" style="width: 100%; font-size: 12px; padding: 6px;" onchange="calcularTotalOrcamento()">
                </td>
                <td data-label="Quantidade">
                    <input type="number" class="form-input item-quantidade" value="1" min="1" step="1" style="width: 100%; font-size: 12px; padding: 6px; text-align: center;" onchange="calcularItem('${itemId}')">
                </td>
                <td data-label="Valor Unit√°rio">
                    <input type="number" class="form-input item-valor-unitario" value="0" min="0" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')">
                </td>
                <td data-label="Desconto %">
                    <input type="number" class="form-input item-desconto" value="0" min="0" max="100" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')">
                </td>
                <td class="item-subtotal" data-label="Subtotal" style="text-align: right; padding: 8px; font-weight: 600;">R$ 0,00</td>
                <td data-label="A√ß√µes" style="text-align: center;">
                    <button type="button" class="btn-action" onclick="removerItemOrcamento('${itemId}')" style="border-color: var(--danger); color: var(--danger); padding: 4px 8px;">‚úó</button>
                </td>
            `;
            tbody.appendChild(row);
            calcularTotalOrcamento();
        }

        // Remover item do or√ßamento
        function removerItemOrcamento(itemId) {
            const row = document.getElementById(itemId);
            if (row) {
                row.remove();
                calcularTotalOrcamento();
                
                // Se n√£o houver mais itens, mostrar mensagem
                const tbody = document.getElementById('orcamentoItensBody');
                if (tbody.children.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-gray); font-style: italic;">
                                Nenhum item adicionado. Clique em "Adicionar Item" para come√ßar.
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Toggle submenu de servi√ßos (para or√ßamento)
        function toggleSubmenu(contexto, servico) {
            const prefix = contexto === 'orcamento' ? 'orcamento' : '';
            
            // Mapear nomes de servi√ßos para IDs corretos (tratando underscores)
            const servicoMap = {
                'redes_sociais': 'RedesSociais',
                'automacao': 'Automacao',
                'site': 'Site',
                'trafego': 'Trafego',
                'design': 'Design'
            };
            
            const servicoFormatted = servicoMap[servico] || servico.charAt(0).toUpperCase() + servico.slice(1);
            const submenuId = prefix ? `orcamentoSubmenu${servicoFormatted}` : `submenu${servicoFormatted}`;
            const checkboxId = prefix ? `orcamentoServico${servicoFormatted}` : `servico${servicoFormatted}`;
            
            const submenu = document.getElementById(submenuId);
            const checkbox = document.getElementById(checkboxId);
            
            if (submenu && checkbox) {
                if (checkbox.checked) {
                    submenu.classList.add('active');
                } else {
                    submenu.classList.remove('active');
                    // Desmarcar todos os subitens quando o principal √© desmarcado
                    submenu.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                        if (cb.checked) {
                            cb.checked = false;
                            if (contexto === 'orcamento') {
                                removerServicoDoOrcamento(cb.value);
                            }
                        }
                    });
                }
            }
        }

        // Adicionar servi√ßo automaticamente aos itens do or√ßamento
        function adicionarServicoAoOrcamento(servicoId, descricao) {
            const checkbox = document.querySelector(`#orcamentoServicosContainer input[value="${servicoId}"]`);
            if (!checkbox) return;

            const tbody = document.getElementById('orcamentoItensBody');
            
            // Remover mensagem de "nenhum item"
            if (tbody.children.length === 1 && tbody.children[0].children.length === 1) {
                tbody.innerHTML = '';
            }

            if (checkbox.checked) {
                // Verificar se o item j√° existe
                const existingItem = Array.from(tbody.querySelectorAll('tr')).find(row => {
                    const descInput = row.querySelector('.item-descricao');
                    return descInput && descInput.value === descricao;
                });

                if (!existingItem) {
                    // Adicionar novo item
                    const itemId = 'item_' + (++itemCounter);
                    const row = document.createElement('tr');
                    row.id = itemId;
                    row.dataset.servicoId = servicoId;
                    row.innerHTML = `
                        <td data-label="Descri√ß√£o">
                            <input type="text" class="form-input item-descricao" value="${descricao}" style="width: 100%; font-size: 12px; padding: 6px;" onchange="calcularTotalOrcamento()">
                        </td>
                        <td data-label="Quantidade">
                            <input type="number" class="form-input item-quantidade" value="1" min="1" step="1" style="width: 100%; font-size: 12px; padding: 6px; text-align: center;" onchange="calcularItem('${itemId}')">
                        </td>
                        <td data-label="Valor Unit√°rio">
                            <input type="number" class="form-input item-valor-unitario" value="0" min="0" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')" placeholder="0.00">
                        </td>
                        <td data-label="Desconto %">
                            <input type="number" class="form-input item-desconto" value="0" min="0" max="100" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')">
                        </td>
                        <td class="item-subtotal" data-label="Subtotal" style="text-align: right; padding: 8px; font-weight: 600;">R$ 0,00</td>
                        <td data-label="A√ß√µes" style="text-align: center;">
                            <button type="button" class="btn-action" onclick="removerItemOrcamento('${itemId}')" style="border-color: var(--danger); color: var(--danger); padding: 4px 8px;">‚úó</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                    calcularTotalOrcamento();
                }
            } else {
                // Remover item quando desmarcado
                removerServicoDoOrcamento(servicoId);
            }
        }

        // Remover servi√ßo dos itens do or√ßamento
        function removerServicoDoOrcamento(servicoId) {
            const tbody = document.getElementById('orcamentoItensBody');
            const row = Array.from(tbody.querySelectorAll('tr')).find(r => r.dataset.servicoId === servicoId);
            if (row) {
                row.remove();
                calcularTotalOrcamento();
                
                // Se n√£o houver mais itens, mostrar mensagem
                if (tbody.children.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-gray); font-style: italic;">
                                Nenhum item adicionado. Clique em "Adicionar Item" para come√ßar.
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // Calcular subtotal de um item
        function calcularItem(itemId) {
            const row = document.getElementById(itemId);
            if (!row) return;

            const quantidade = parseFloat(row.querySelector('.item-quantidade').value) || 0;
            const valorUnitario = parseFloat(row.querySelector('.item-valor-unitario').value) || 0;
            const descontoPercent = parseFloat(row.querySelector('.item-desconto').value) || 0;

            const subtotal = quantidade * valorUnitario;
            const descontoValor = subtotal * (descontoPercent / 100);
            const subtotalFinal = subtotal - descontoValor;

            row.querySelector('.item-subtotal').textContent = formatCurrency(subtotalFinal);
            calcularTotalOrcamento();
        }

        // Calcular total do or√ßamento
        function calcularTotalOrcamento() {
            const tbody = document.getElementById('orcamentoItensBody');
            let subtotal = 0;

            tbody.querySelectorAll('tr').forEach(row => {
                const quantidade = parseFloat(row.querySelector('.item-quantidade')?.value) || 0;
                const valorUnitario = parseFloat(row.querySelector('.item-valor-unitario')?.value) || 0;
                const descontoPercent = parseFloat(row.querySelector('.item-desconto')?.value) || 0;

                const itemSubtotal = quantidade * valorUnitario;
                const descontoValor = itemSubtotal * (descontoPercent / 100);
                subtotal += itemSubtotal - descontoValor;
            });

            const descontoGeral = parseFloat(document.getElementById('orcamentoDescontoGeral').value) || 0;
            const total = subtotal - descontoGeral;

            document.getElementById('orcamentoSubtotal').textContent = formatCurrency(subtotal);
            document.getElementById('orcamentoDescontoGeralValor').textContent = formatCurrency(descontoGeral);
            document.getElementById('orcamentoValorTotal').textContent = formatCurrency(total);
            document.getElementById('orcamentoValor').value = total.toFixed(2);
        }

        // Coletar itens do formul√°rio
        function coletarItensOrcamento() {
            const tbody = document.getElementById('orcamentoItensBody');
            const itens = [];

            tbody.querySelectorAll('tr').forEach(row => {
                const descricao = row.querySelector('.item-descricao')?.value.trim();
                if (!descricao) return; // Pular itens sem descri√ß√£o

                const quantidade = parseFloat(row.querySelector('.item-quantidade')?.value) || 0;
                const valorUnitario = parseFloat(row.querySelector('.item-valor-unitario')?.value) || 0;
                const descontoPercent = parseFloat(row.querySelector('.item-desconto')?.value) || 0;
                const subtotal = parseFloat(row.querySelector('.item-subtotal')?.textContent.replace(/[^\d,.-]/g, '').replace(',', '.')) || 0;

                itens.push({
                    descricao,
                    quantidade,
                    valor_unitario: valorUnitario,
                    desconto_percent: descontoPercent,
                    subtotal
                });
            });

            return itens;
        }

        // Carregar itens no formul√°rio
        function carregarItensOrcamento(itens) {
            const tbody = document.getElementById('orcamentoItensBody');
            tbody.innerHTML = '';

            if (!itens || itens.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-gray); font-style: italic;">
                            Nenhum item adicionado. Clique em "Adicionar Item" para come√ßar.
                        </td>
                    </tr>
                `;
                return;
            }

            itemCounter = 0;
            itens.forEach(item => {
                const itemId = 'item_' + (++itemCounter);
                const row = document.createElement('tr');
                row.id = itemId;
                row.innerHTML = `
                    <td data-label="Descri√ß√£o">
                        <input type="text" class="form-input item-descricao" value="${item.descricao || ''}" placeholder="Descri√ß√£o do item" style="width: 100%; font-size: 12px; padding: 6px;" onchange="calcularTotalOrcamento()">
                    </td>
                    <td data-label="Quantidade">
                        <input type="number" class="form-input item-quantidade" value="${item.quantidade || 1}" min="1" step="1" style="width: 100%; font-size: 12px; padding: 6px; text-align: center;" onchange="calcularItem('${itemId}')">
                    </td>
                    <td data-label="Valor Unit√°rio">
                        <input type="number" class="form-input item-valor-unitario" value="${item.valor_unitario || 0}" min="0" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')">
                    </td>
                    <td data-label="Desconto %">
                        <input type="number" class="form-input item-desconto" value="${item.desconto_percent || 0}" min="0" max="100" step="0.01" style="width: 100%; font-size: 12px; padding: 6px; text-align: right;" onchange="calcularItem('${itemId}')">
                    </td>
                    <td class="item-subtotal" data-label="Subtotal" style="text-align: right; padding: 8px; font-weight: 600;">${formatCurrency(item.subtotal || 0)}</td>
                    <td data-label="A√ß√µes" style="text-align: center;">
                        <button type="button" class="btn-action" onclick="removerItemOrcamento('${itemId}')" style="border-color: var(--danger); color: var(--danger); padding: 4px 8px;">‚úó</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            calcularTotalOrcamento();
        }

        // Aprovar or√ßamento
        async function aprovarOrcamento(id) {
            if (!confirm('Deseja aprovar este or√ßamento?')) return;

            try {
                const { error } = await supabase
                    .from('orcamentos')
                    .update({ status: 'aprovado' })
                    .eq('id', id);

                if (error) throw error;
                alert('Or√ßamento aprovado com sucesso!');
                loadOrcamentos();
                closeOrcamentoDetailsModal();
            } catch (error) {
                console.error('Erro ao aprovar or√ßamento:', error);
                alert('Erro ao aprovar or√ßamento: ' + (error.message || 'Erro desconhecido'));
            }
        }

        // Recusar or√ßamento
        async function recusarOrcamento(id) {
            if (!confirm('Deseja recusar este or√ßamento?')) return;

            try {
                const { error } = await supabase
                    .from('orcamentos')
                    .update({ status: 'rejeitado' })
                    .eq('id', id);

                if (error) throw error;
                alert('Or√ßamento recusado.');
                loadOrcamentos();
                closeOrcamentoDetailsModal();
            } catch (error) {
                console.error('Erro ao recusar or√ßamento:', error);
                alert('Erro ao recusar or√ßamento: ' + (error.message || 'Erro desconhecido'));
            }
        }

        // Gerar PDF do or√ßamento
        async function gerarPDFOrcamento() {
            try {
                const orcamentoId = document.getElementById('orcamentoDetailsModal').dataset.orcamentoId;
                if (!orcamentoId) {
                    alert('Or√ßamento n√£o encontrado');
                    return;
                }
                
                const orcamento = allOrcamentos.find(o => o.id === orcamentoId);
                if (!orcamento) {
                    alert('Or√ßamento n√£o encontrado');
                    return;
                }

                // Buscar dados completos do cliente
                let clienteCompleto = orcamento.cliente || {};
                if (orcamento.cliente_id && !clienteCompleto.endereco) {
                    try {
                        const { data, error } = await supabase
                            .from('clientes')
                            .select('*')
                            .eq('id', orcamento.cliente_id)
                            .single();
                        if (!error && data) {
                            clienteCompleto = data;
                        }
                    } catch (e) {
                        console.warn('Erro ao buscar dados completos do cliente:', e);
                    }
                }

                // Verificar se jsPDF est√° dispon√≠vel
                if (!window.jspdf) {
                    alert('Biblioteca de PDF n√£o carregada. Por favor, recarregue a p√°gina.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Configura√ß√µes
                const margin = 20;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let y = margin;

                // ========== CABE√áALHO - DADOS DA EMPRESA ==========
                let logoLoaded = false;
                
                // Tentar adicionar logo
                try {
                    const logoUrl = 'https://zhzhpctsndrcedukivhk.supabase.co/storage/v1/object/public/logo/LOGO%203D%20SEM%20FUNDO%20(1).png';
                    
                    // Usar fetch para obter a imagem como base64
                    const response = await fetch(logoUrl);
                    if (response.ok) {
                        const blob = await response.blob();
                        const reader = new FileReader();
                        
                        await new Promise((resolve, reject) => {
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(blob);
                        });
                        
                        const logoData = reader.result;
                        // Adicionar logo (ajustar tamanho conforme necess√°rio)
                        doc.addImage(logoData, 'PNG', margin, 5, 60, 25);
                        logoLoaded = true;
                    }
                } catch (e) {
                    console.warn('Erro ao carregar logo:', e);
                }
                
                // Se logo n√£o carregou, usar texto
                if (!logoLoaded) {
                    doc.setFillColor(255, 102, 0);
                    doc.rect(0, 0, pageWidth, 50, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(28);
                    doc.setFont(undefined, 'bold');
                    doc.text('AUTOVIZION', margin, 30);
                    
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    doc.text('Solu√ß√µes em Marketing Digital e Tecnologia', margin, 38);
                }
                
                // Dados da empresa no cabe√ßalho (lado direito) - Melhor formatado
                const dadosX = pageWidth - margin - 60;
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('AUTOVIZION', dadosX, 12);
                
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(60, 60, 60);
                doc.text('www.autovizon.com.br', dadosX, 20);
                doc.text('autovizioncomercial@gmail.com', dadosX, 26);
                doc.text('(14) 99600-5936', dadosX, 32);
                
                // Linha divis√≥ria abaixo do cabe√ßalho
                doc.setDrawColor(200, 200, 200);
                doc.line(margin, 35, pageWidth - margin, 35);
                
                y = 45;

                // ========== T√çTULO DO DOCUMENTO ==========
                // Fundo colorido para o t√≠tulo
                doc.setFillColor(255, 102, 0);
                doc.rect(margin, y - 5, pageWidth - (margin * 2), 20, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(22);
                doc.setFont(undefined, 'bold');
                doc.text('PROPOSTA COMERCIAL', margin + 5, y + 8);
                
                // N√∫mero e data √† direita (sobre o fundo)
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`N¬∫ ${orcamento.numero || 'N/A'}`, pageWidth - margin - 30, y + 2);
                doc.text(`Data: ${formatDate(orcamento.data)}`, pageWidth - margin - 30, y + 9);
                
                y += 20;

                // ========== DADOS DO CLIENTE ==========
                // Definir vari√°veis do cliente primeiro
                const clienteNome = clienteCompleto.nome || clienteCompleto.empresa || 'Cliente n√£o encontrado';
                const clienteEmpresa = clienteCompleto.empresa || '';
                const clienteCpfCnpj = clienteCompleto.cpf_cnpj || '';
                const clienteEndereco = clienteCompleto.endereco || '';
                const clienteCidade = clienteCompleto.cidade || '';
                const clienteEstado = clienteCompleto.estado || '';
                const clienteCep = clienteCompleto.cep || '';
                const clienteTelefone = clienteCompleto.telefone || '';
                const clienteEmail = clienteCompleto.email || '';

                // ========== INTRODU√á√ÉO ==========
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(60, 60, 60);
                const introText = `Prezado(a) ${clienteNome},`;
                doc.text(introText, margin, y);
                y += 8;
                
                const apresentacao = `√â com grande entusiasmo que finalizamos a an√°lise de suas necessidades e desenvolvemos uma proposta comercial estrat√©gica. Nosso foco √© apresentar solu√ß√µes concretas que impulsionar√£o seus resultados e atender√£o, com excel√™ncia, aos seus objetivos espec√≠ficos.`;
                const apresentacaoLines = doc.splitTextToSize(apresentacao, pageWidth - (margin * 2));
                doc.text(apresentacaoLines, margin, y);
                y += apresentacaoLines.length * 5 + 10;

                // ========== DADOS DO CLIENTE ==========
                // Fundo com cor laranja suave
                doc.setFillColor(255, 102, 0);
                doc.rect(margin, y, pageWidth - (margin * 2), 8, 'F');
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(255, 255, 255);
                doc.text('DADOS DO CLIENTE', margin + 3, y + 6);
                y += 12;
                
                doc.setTextColor(0, 0, 0);
                
                doc.text(`Cliente: ${clienteNome}`, margin, y);
                y += 6;
                if (clienteEmpresa && clienteEmpresa !== clienteNome) {
                    doc.text(`Empresa: ${clienteEmpresa}`, margin, y);
                    y += 6;
                }
                if (clienteCpfCnpj) {
                    doc.text(`CPF/CNPJ: ${clienteCpfCnpj}`, margin, y);
                    y += 6;
                }
                if (clienteEndereco) {
                    let enderecoCompleto = clienteEndereco;
                    if (clienteCidade) enderecoCompleto += `, ${clienteCidade}`;
                    if (clienteEstado) enderecoCompleto += ` - ${clienteEstado}`;
                    if (clienteCep) enderecoCompleto += ` - CEP: ${clienteCep}`;
                    doc.text(`Endere√ßo: ${enderecoCompleto}`, margin, y);
                    y += 6;
                }
                if (clienteTelefone) {
                    doc.text(`Telefone: ${clienteTelefone}`, margin, y);
                    y += 6;
                }
                if (clienteEmail) {
                    doc.text(`E-mail: ${clienteEmail}`, margin, y);
                    y += 6;
                }
                
                y += 10;

                // ========== ITENS DO OR√áAMENTO ==========
                // Fundo com cor laranja suave
                doc.setFillColor(255, 102, 0);
                doc.rect(margin, y - 3, pageWidth - (margin * 2), 10, 'F');
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(255, 255, 255);
                doc.text('ITENS DO OR√áAMENTO', margin + 3, y + 4);
                y += 12;
                
                doc.setTextColor(0, 0, 0);

                const itens = orcamento.itens || [];
                if (itens.length > 0) {
                    // Definir posi√ß√µes das colunas de forma clara
                    const colDescricao = margin + 2;
                    const colQtd = margin + 65;
                    const colValorUnit = margin + 85;
                    const colDesconto = margin + 120;
                    
                    // Cabe√ßalho da tabela com cor destacada
                    doc.setFillColor(45, 45, 45);
                    doc.rect(margin, y - 5, pageWidth - (margin * 2), 8, 'F');
                    
                    doc.setFontSize(9);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(255, 255, 255);
                    doc.text('Descri√ß√£o', colDescricao, y);
                    doc.text('Qtd', colQtd, y);
                    doc.text('Valor Unit.', colValorUnit, y);
                    doc.text('Desconto', colDesconto, y);
                    y += 8;

                    let subtotal = 0;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    
                    itens.forEach((item, index) => {
                        // Verificar se precisa de nova p√°gina (deixar espa√ßo para pelo menos 3 linhas + totais)
                        if (y > pageHeight - 80) {
                            doc.addPage();
                            y = margin + 10;
                        }
                        
                        // Linha alternada (opcional)
                        if (index % 2 === 0) {
                            doc.setFillColor(250, 250, 250);
                            doc.rect(margin, y - 3, pageWidth - (margin * 2), 6, 'F');
                        }
                        
                        // Descri√ß√£o (pode quebrar linha se muito longa)
                        const descricao = item.descricao || '-';
                        const descLines = doc.splitTextToSize(descricao, 60);
                        const firstLineY = y;
                        doc.text(descLines, colDescricao, firstLineY);
                        
                        // Quantidade
                        const qtd = (item.quantidade || 0).toString();
                        doc.text(qtd, colQtd, firstLineY);
                        
                        // Valor unit√°rio
                        doc.text(formatCurrency(item.valor_unitario || 0), colValorUnit, firstLineY);
                        
                        // Desconto
                        const desconto = item.desconto_percent || 0;
                        doc.text(desconto + '%', colDesconto, firstLineY);
                        
                        subtotal += item.subtotal || 0;
                        y += Math.max(6, descLines.length * 6);
                    });

                    y += 5;
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, y, pageWidth - margin, y);
                    y += 10;

                    // ========== TOTAIS ==========
                    // Verificar se h√° espa√ßo para os totais (subtotal + desconto + total + linha = ~30px)
                    if (y > pageHeight - 50) {
                        doc.addPage();
                        y = margin + 10;
                    }
                    
                    const descontoGeral = parseFloat(orcamento.desconto_geral || 0);
                    const totalX = pageWidth - margin - 35;
                    const labelX = totalX - 50;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    doc.text('Subtotal:', labelX, y);
                    doc.text(formatCurrency(subtotal), totalX, y);
                    y += 7;

                    if (descontoGeral > 0) {
                        doc.setTextColor(200, 0, 0);
                        doc.text('Desconto Geral:', labelX, y);
                        doc.text(formatCurrency(descontoGeral), totalX, y);
                        y += 7;
                    }

                    // Linha destacada antes do total
                    doc.setDrawColor(255, 102, 0);
                    doc.setLineWidth(1);
                    doc.line(labelX - 10, y, totalX + 10, y);
                    y += 8;

                    // Fundo destacado para o total
                    doc.setFillColor(255, 102, 0);
                    doc.rect(labelX - 10, y - 8, totalX - labelX + 20, 12, 'F');
                    
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(255, 255, 255);
                    doc.text('TOTAL:', labelX, y + 2);
                    doc.text(formatCurrency(orcamento.valor || 0), totalX, y + 2);
                    y += 15;
                } else {
                    doc.setFontSize(10);
                    doc.setTextColor(128, 128, 128);
                    doc.text('Nenhum item cadastrado', margin, y);
                    y += 10;
                }

                // ========== CONDI√á√ïES COMERCIAIS ==========
                // Extrair condi√ß√µes comerciais das observa√ß√µes
                const observacoes = orcamento.observacoes || '';
                let condicoesPagamento = '';
                let formaPagamento = '';
                let prazoEntrega = '';
                
                if (observacoes.includes('=== CONDI√á√ïES COMERCIAIS ===')) {
                    const partes = observacoes.split('=== CONDI√á√ïES COMERCIAIS ===');
                    const condicoesTexto = partes[1] || '';
                    
                    // Extrair condi√ß√µes de pagamento
                    const matchCondicoes = condicoesTexto.match(/Condi√ß√µes de Pagamento:\s*(.+?)(?:\n|$)/i);
                    if (matchCondicoes) condicoesPagamento = matchCondicoes[1].trim();
                    
                    // Extrair forma de pagamento
                    const matchForma = condicoesTexto.match(/Forma de Pagamento:\s*(.+?)(?:\n|$)/i);
                    if (matchForma) formaPagamento = matchForma[1].trim();
                    
                    // Extrair prazo de entrega
                    const matchPrazo = condicoesTexto.match(/Prazo de Entrega:\s*(.+?)(?:\n|$)/i);
                    if (matchPrazo) prazoEntrega = matchPrazo[1].trim();
                }

                if (condicoesPagamento || formaPagamento || prazoEntrega) {
                    // Verificar se precisa de nova p√°gina
                    if (y > pageHeight - 60) {
                        doc.addPage();
                        y = margin + 10;
                    }

                    doc.setFillColor(245, 245, 245);
                    doc.rect(margin, y, pageWidth - (margin * 2), 8, 'F');
                    
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(0, 0, 0);
                    doc.text('CONDI√á√ïES COMERCIAIS', margin + 3, y + 6);
                    y += 12;

                    doc.setFontSize(9);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(60, 60, 60);

                    if (condicoesPagamento) {
                        doc.setFont(undefined, 'bold');
                        doc.text('Condi√ß√µes de Pagamento:', margin, y);
                        y += 6;
                        doc.setFont(undefined, 'normal');
                        const condicoesLines = doc.splitTextToSize(condicoesPagamento, pageWidth - (margin * 2));
                        doc.text(condicoesLines, margin + 5, y);
                        y += condicoesLines.length * 5 + 5;
                    }

                    if (formaPagamento) {
                        doc.setFont(undefined, 'bold');
                        doc.text('Forma de Pagamento:', margin, y);
                        y += 6;
                        doc.setFont(undefined, 'normal');
                        const formaLines = doc.splitTextToSize(formaPagamento, pageWidth - (margin * 2));
                        doc.text(formaLines, margin + 5, y);
                        y += formaLines.length * 5 + 5;
                    }

                    if (prazoEntrega) {
                        doc.setFont(undefined, 'bold');
                        doc.text('Prazo de Entrega:', margin, y);
                        y += 6;
                        doc.setFont(undefined, 'normal');
                        const prazoLines = doc.splitTextToSize(prazoEntrega, pageWidth - (margin * 2));
                        doc.text(prazoLines, margin + 5, y);
                        y += prazoLines.length * 5 + 5;
                    }

                    y += 5;
                }

                // ========== TERMOS E CONDI√á√ïES ==========
                // Verificar se precisa de nova p√°gina
                if (y > pageHeight - 80) {
                    doc.addPage();
                    y = margin + 10;
                }

                doc.setFillColor(250, 250, 250);
                doc.rect(margin, y, pageWidth - (margin * 2), 8, 'F');
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('TERMOS E CONDI√á√ïES', margin + 3, y + 6);
                y += 12;

                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(60, 60, 60);

                const termos = [
                    '1. Esta proposta tem validade de ' + (orcamento.validade_dias || 30) + ' dias corridos a partir da data de emiss√£o.',
                    '2. Os valores apresentados est√£o sujeitos a altera√ß√£o sem aviso pr√©vio ap√≥s o prazo de validade.',
                    '3. O in√≠cio dos trabalhos est√° condicionado √† aprova√ß√£o formal desta proposta e ao pagamento conforme condi√ß√µes acordadas.',
                    '4. Todas as informa√ß√µes e materiais fornecidos pelo cliente ser√£o tratados com confidencialidade.',
                    '5. A empresa se reserva o direito de alterar prazos em caso de atraso na entrega de materiais ou informa√ß√µes necess√°rias pelo cliente.',
                    '6. Esta proposta n√£o inclui altera√ß√µes ou modifica√ß√µes n√£o especificadas, que ser√£o or√ßadas separadamente.',
                    '7. O cliente se compromete a fornecer todas as informa√ß√µes e materiais necess√°rios em tempo h√°bil para a execu√ß√£o dos servi√ßos.',
                    '8. Em caso de cancelamento, ser√£o aplicadas as pol√≠ticas de reembolso conforme acordo pr√©vio.'
                ];

                termos.forEach((termo, index) => {
                    if (y > pageHeight - 20) {
                        doc.addPage();
                        y = margin + 10;
                    }
                    const termoLines = doc.splitTextToSize(termo, pageWidth - (margin * 2) - 5);
                    doc.text(termoLines, margin + 5, y);
                    y += termoLines.length * 4 + 3;
                });

                y += 10;

                // ========== OBSERVA√á√ïES ==========
                // Extrair observa√ß√µes sem as condi√ß√µes comerciais
                let observacoesParaPDF = observacoes || '';
                if (observacoesParaPDF.includes('=== CONDI√á√ïES COMERCIAIS ===')) {
                    const partes = observacoesParaPDF.split('=== CONDI√á√ïES COMERCIAIS ===');
                    observacoesParaPDF = partes[0].trim();
                }
                
                if (observacoesParaPDF) {
                    if (y > pageHeight - 40) {
                        doc.addPage();
                        y = margin + 10;
                    }
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(0, 0, 0);
                    doc.text('OBSERVA√á√ïES:', margin, y);
                    y += 6;
                    
                    doc.setFont(undefined, 'normal');
                    const splitObservacoes = doc.splitTextToSize(observacoesParaPDF, pageWidth - (margin * 2));
                    doc.text(splitObservacoes, margin, y);
                    y += splitObservacoes.length * 6 + 10;
                }

                // ========== VALIDADE E FORMA DE PAGAMENTO ==========
                // Verificar se h√° espa√ßo suficiente na p√°gina (condi√ß√µes ~35px + rodap√© ~20px = 55px)
                // Se n√£o houver espa√ßo, quebrar para nova p√°gina
                if (y > pageHeight - 55) {
                    doc.addPage();
                    y = margin + 10;
                }
                
                y += 5;
                doc.setFillColor(250, 250, 250);
                const condicoesHeight = 35;
                doc.rect(margin, y, pageWidth - (margin * 2), condicoesHeight, 'F');
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('CONDI√á√ïES COMERCIAIS', margin + 3, y + 8);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                doc.setTextColor(60, 60, 60);
                
                let condY = y + 16;
                doc.text(`Validade da proposta: ${orcamento.validade_dias || 30} dias, sujeita √† disponibilidade de recursos.`, margin + 3, condY);
                condY += 6;
                
                doc.text('Forma de pagamento: A combinar, sujeita √† aprova√ß√£o m√∫tua.', margin + 3, condY);
                condY += 6;
                
                doc.text('Prazo de entrega: A combinar.', margin + 3, condY);
                condY += 6;
                
                doc.text('Condi√ß√µes especiais: Conforme negocia√ß√£o.', margin + 3, condY);
                
                y += condicoesHeight + 5;

                // ========== RODAP√â COM TERMOS ==========
                // Verificar se h√° espa√ßo para o rodap√© (termos + contato = ~25px)
                if (y > pageHeight - 25) {
                    doc.addPage();
                    y = margin + 10;
                }
                
                // Linha divis√≥ria antes do rodap√©
                doc.setDrawColor(200, 200, 200);
                doc.line(margin, y, pageWidth - margin, y);
                y += 5;
                
                doc.setFontSize(7);
                doc.setTextColor(100, 100, 100);
                doc.setFont(undefined, 'normal');
                
                const termosRodape = [
                    'A contrata√ß√£o dos servi√ßos est√° sujeita √† assinatura de contrato espec√≠fico.',
                    'Para mais informa√ß√µes, entre em contato conosco atrav√©s dos canais indicados.'
                ];
                
                termosRodape.forEach(termo => {
                    // Verificar se precisa de nova p√°gina para os termos
                    if (y > pageHeight - 15) {
                        doc.addPage();
                        y = margin + 10;
                    }
                    const termoLines = doc.splitTextToSize(termo, pageWidth - (margin * 2));
                    doc.text(termoLines, margin, y);
                    y += termoLines.length * 4 + 2;
                });
                
                // Informa√ß√µes de contato no rodap√© - Sempre na √∫ltima linha da p√°gina
                const contatoY = pageHeight - 8;
                doc.setFontSize(7);
                doc.setTextColor(128, 128, 128);
                doc.setFont(undefined, 'normal');
                doc.text('AUTOVIZION', margin, contatoY);
                doc.text('|', margin + 25, contatoY);
                doc.text('www.autovizon.com.br', margin + 30, contatoY);
                doc.text('|', margin + 70, contatoY);
                doc.text('autovizioncomercial@gmail.com', margin + 75, contatoY);
                doc.text('|', margin + 130, contatoY);
                doc.text('(14) 99600-5936', margin + 135, contatoY);
                
                // Salvar PDF
                const fileName = `Proposta_${orcamento.numero || 'N'}_${clienteNome.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF: ' + (error.message || 'Erro desconhecido'));
            }
        }

        // Fun√ß√µes para menu mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeSidebarMobile() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // Fechar sidebar ao clicar no overlay
        document.getElementById('sidebarOverlay').addEventListener('click', closeSidebarMobile);

        // Fechar sidebar ao redimensionar para desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                closeSidebarMobile();
            }
        });

        // ========== CONFIGURA√á√ÉO DA PLATAFORMA ==========
        // Configure aqui o nome e logo da sua plataforma
        
        const PLATAFORMA_CONFIG = {
            nome: 'Vizion Hub',  // Nome da plataforma
            emoji: '',  // Emoji ao lado do nome (deixar vazio para n√£o exibir)
            logoUrl: 'https://zhzhpctsndrcedukivhk.supabase.co/storage/v1/object/public/logo/LOGO%203D%20SEM%20FUNDO%20(1).png',  // Logo na p√°gina de login
            sidebarLogoUrl: 'https://zhzhpctsndrcedukivhk.supabase.co/storage/v1/object/public/logo/VizionHUB.png',  // Logo no sidebar
        };

        // Aplicar configura√ß√µes
        function aplicarConfiguracaoPlataforma() {
            // Atualizar nome (com emoji apenas se fornecido)
            const nomeCompleto = PLATAFORMA_CONFIG.emoji ? `${PLATAFORMA_CONFIG.emoji} ${PLATAFORMA_CONFIG.nome}` : PLATAFORMA_CONFIG.nome;
            
            if (PLATAFORMA_CONFIG.nome) {
                // Se tiver logo, ocultar o t√≠tulo no login (s√≥ mostrar logo)
                if (PLATAFORMA_CONFIG.logoUrl) {
                    document.getElementById('loginTitle').style.display = 'none';
                } else {
                    document.getElementById('loginTitle').textContent = nomeCompleto;
                    document.getElementById('loginTitle').style.display = 'block';
                }
                
                document.getElementById('sidebarLogoText').textContent = nomeCompleto;
                document.getElementById('pageTitle').textContent = PLATAFORMA_CONFIG.nome + ' - Empresarial';
            }

            // Aplicar logo na p√°gina de login
            if (PLATAFORMA_CONFIG.logoUrl) {
                const loginLogo = document.getElementById('loginLogo');
                
                if (loginLogo) {
                    loginLogo.src = PLATAFORMA_CONFIG.logoUrl;
                    loginLogo.style.display = 'block';
                    loginLogo.onerror = function() {
                        this.style.display = 'none';
                        console.warn('Erro ao carregar logo do login');
                    };
                }
            }

            // Aplicar logo no sidebar
            if (PLATAFORMA_CONFIG.sidebarLogoUrl) {
                const sidebarLogo = document.getElementById('sidebarLogo');
                const sidebarLogoText = document.getElementById('sidebarLogoText');
                
                if (sidebarLogo) {
                    sidebarLogo.src = PLATAFORMA_CONFIG.sidebarLogoUrl;
                    sidebarLogo.style.display = 'block';
                    sidebarLogo.onerror = function() {
                        this.style.display = 'none';
                        console.warn('Erro ao carregar logo do sidebar');
                    };
                }
                
                // Ocultar o texto quando tiver logo
                if (sidebarLogoText) {
                    sidebarLogoText.style.display = 'none';
                }
            }
        }

        // Verificar autentica√ß√£o ao carregar
        aplicarConfiguracaoPlataforma();
        checkAuth();
    </script>
</body>
</html>

